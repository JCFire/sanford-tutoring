define("siteBackground",["lodash","santaProps","core","utils","mediaCommon","backgroundCommon"],function(a,b,c,d,e,f){"use strict";var g="100%";var h="100%";var i=0;var j="120%";var k=0;var l=d.balataConsts;var m=e.mediaLogicMixins.fill;function n(b,c){var d=a.get(b,"scrollType");var e=a.get(b,["mediaRef","type"]);var f=e==="Image"||e==="WixVideo";if(!c.fixedSiteBackground||c.isMobileView||!f){d="scroll"}return d}function o(a,b){var c=b;if(a.isMobileView||a.isAndroidOldBrowser){c="scroll"}else if(!a.fixedSiteBackground){c=""}return c}function p(b,c,d){var e="absolute";var f=a.get(c,["mediaRef","type"]);if(!b.isMobileDevice&&(f==="WixVideo"||d==="fixed"||d==="parallax")){e="fixed"}return e}function q(a,b,c){var e=o(a,n(b,a));var f=p(a,b,e);var i={top:0,height:h,width:g,backgroundColor:d.colorParser.getColor(a.colorsMap,b.color),display:c?"none":"",position:f};return i}function r(a){var b=h;if(a==="parallax"){b=j}return b}function s(a){var b=i;if(a==="parallax"){b=k}return b}function t(a,b){var c=b.mediaRef;var d={position:"absolute",top:s(n(b,a)),height:r(n(b,a)),width:g,opacity:c&&c.opacity};return d}function u(){return[{action:"bgScrub",name:"SiteBackgroundParallax",duration:1,delay:0}]}function v(b,c){var d=b.mediaRef||{};var e=c.mediaRef||{};var f=!b.mediaRef&&!c.mediaRef;var g=f||d.type===e.type;var h=d.type==="WixVideo"&&g;var i=["mediaRef","imageOverlay"];var j=["type","alignType","fittingType","scrollType","colorOverlay","colorOverlayOpacity","color","videoId","uri","opacity"];if(h){j=a.without(j,"color")}else if(f){j=["color"]}return g&&w(b,c,i,j)}function w(b,c,d,e){var f=a.every(e,function(a){return(b&&b[a])===(c&&c[a])});f=f&&a.every(d,function(a){return b?w(b[a],c[a],d,e):true});return f}function x(a,b){var c=b.colorOverlay?d.colorParser.getColor(a.colorsMap,b.colorOverlay,b.colorOverlayOpacity):null;var e=y(a,b.imageOverlay);return{position:"absolute",top:0,width:g,height:h,backgroundImage:e,backgroundColor:c}}function y(a,b){if(!b){return null}return"url("+d.urlUtils.joinURL(a.staticMediaUrl,b.uri)+")"}return{displayName:"SiteBackground",mixins:[m,c.compMixins.skinBasedComp,c.compMixins.animationsMixin,f.mixins.backgroundDetectionMixin],propTypes:a.defaults({id:b.Types.Component.id,compData:b.Types.Media.SiteBackground.data,actionsAspect:b.Types.SiteAspects.actionsAspect.isRequired,currentUrlPageId:b.Types.Component.currentUrlPageId,isMobileView:b.Types.isMobileView.isRequired,isTouchDevice:b.Types.Device.isTouchDevice,isAndroidOldBrowser:b.Types.Browser.isAndroidOldBrowser,colorsMap:b.Types.Theme.colorsMap,staticMediaUrl:b.Types.ServiceTopology.staticMediaUrl,componentViewMode:b.Types.RenderFlags.componentViewMode.isRequired,fixedSiteBackground:b.Types.BrowserFlags.fixedSiteBackground.isRequired,mediaQuality:b.Types.Media.SiteBackground.mediaQuality},b.santaTypesUtils.getSantaTypesByDefinition(f.components.bgVideo)),statics:{useSantaTypes:true,behaviors:m.behaviorsAPI},previousScroll:null,getInitialState:function(){this.size={};return{resetAttachment:false,hidePrevious:false}},callForBackgroundChange:function(b){var c={onComplete:function(){if(this.isPageChanged()){a.result(this.refs,["previousVideo","kill"]);this.setState({previousPageBackground:null,resetAttachment:false,hidePrevious:true})}}.bind(this)};this.props.actionsAspect.registerNextBGPageTransition(this,"previous","current",c);this.setState({previousPageBackground:b,resetAttachment:true,hidePrevious:false,currentVisiblePageId:null})},componentWillReceiveProps:function(b){if(this.isPageChanged()){var c=this.props.compData.background;var d=b.compData.background;if(!v(d,c)){this.callForBackgroundChange(c)}else{a.result(this.refs,["previousVideo","kill"]);this.setState({previousPageBackground:null,currentVisiblePageId:this.state.currentVisiblePageId||this.props.compData.background.id})}}},handleParallaxBehavior:function(a){var b=n(a,this.props);var c=this.previousScroll==="parallax"||b==="parallax";if(c){this.previousScroll=b;if(b==="parallax"){this.props.actionsAspect.registerBehaviors("currentImage","siteBackground",u())}else{this.props.actionsAspect.unRegisterBehaviors("currentImage",u())}}},getClasses:function(){return""},isPageChanged:function(){return this.props.compData.background.id!==a.get(this.state,["previousPageBackground","id"])},createVideoComponent:function(b,c){var d={comp:"wysiwyg.viewer.components.background.bgVideo",skin:"skins.viewer.bgVideo.bgVideoSkin",style:"bgVideo"};var e=b.mediaRef;var f=c==="current";if(a.get(e,"type")!=="WixVideo"){if(f){this.setMediaAPI(null)}return null}return this.createChildComponent(e,d.comp,{skin:d.skin,styleId:d.style},{id:this.props.id+c+"Video",notifyMediaState:this.onMediaChange,setMediaAPI:f?this.setMediaAPI:a.noop,mediaQuality:this.props.mediaQuality,className:"siteBackground"+c+"Video"})},getSkinProperties:function(){var b=this.state.currentVisiblePageId||this.props.compData.background.id;var c=a.get(this.state.previousPageBackground,"id","noPrev");c=c===b?"noPrev":c;var d=null;var e=!this.props.isTouchDevice;var f,g,h,i;var j=this.props.id;var k=this.props.compData.background;i={id:j+"_currentImage_"+b,style:t(this.props,k),"data-type":l.BG_IMAGE};if(e){g=this.createVideoComponent(k,"current");if(!g){this.setMediaAPI(null)}}if(this.state.previousPageBackground){d=this.state.previousPageBackground;h={id:j+"_previousImage_"+c,style:d?t(this.props,d):{}};if(e){f=this.createVideoComponent(d,"previous")}}this.handleParallaxBehavior(k);var m={"":{id:j,className:this.getClasses()},current:{key:b+n(k,this.props)+this.props.componentViewMode,id:j+"_current_"+b,style:q(this.props,k,false)},currentImage:i,currentVideo:g,currentOverlay:{id:j+"_currentOverlay_"+b,style:x(this.props,k)},previous:{key:c+n(d,this.props)+this.props.componentViewMode,id:j+"_previous_"+c,style:d?q(this.props,d,this.state.hidePrevious):{}},previousImage:h,previousVideo:f,previousOverlay:{id:j+"_previousOverlay_"+c,style:d?x(this.props,d):{}}};return m}}});
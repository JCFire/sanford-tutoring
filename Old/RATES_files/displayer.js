define("displayer",["lodash","react","reactDOM","core","santaProps","utils","imageClientApi","skins","image","experiment"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=d.compMixins;var l=f.linkRenderer;function m(a){if(a){switch(a){case"left":return"alignLeft";case"center":return"alignCenter";case"right":return"alignRight";default:return"alignLeft"}}}function n(a){var b={textAlign:a};if(j.isOpen("sv_fixGridsTextDirection")&&a==="right"){b.direction="rtl"}return b}return{displayName:"Displayer",mixins:[k.skinBasedComp,k.skinInfo],propTypes:a.assign({browser:e.Types.Browser.browser.isRequired,rootNavigationInfo:e.Types.Component.rootNavigationInfo.isRequired,linkRenderInfo:e.Types.Link.linkRenderInfo.isRequired,isMobileView:e.Types.isMobileView,isMobileDevice:e.Types.Device.isMobileDevice,isAndroidOldBrowser:e.Types.Browser.isAndroidOldBrowser,imageIndex:b.PropTypes.number.isRequired,compProp:b.PropTypes.object.isRequired,compData:b.PropTypes.object.isRequired,imageWrapperSize:b.PropTypes.object.isRequired,heightDiff:b.PropTypes.number,widthDiff:b.PropTypes.number,bottomGap:b.PropTypes.number,galleryId:b.PropTypes.string,isSelected:b.PropTypes.bool,galleryDataId:b.PropTypes.string,skin:b.PropTypes.string,id:b.PropTypes.string,showPanelState:b.PropTypes.string,onClick:b.PropTypes.func},e.santaTypesUtils.getSantaTypesByDefinition(i)),statics:{useSantaTypes:true},getInitialState:function(){return{$showPanel:"defaultPanelState",$displayDevice:this.props.isMobileView?"mobileView":"desktopView",$textAlignmentState:m(this.props.compProp.alignText),$selected:this.props.isSelected?"selected":"unselected",$scaling:this.props.compProp.imageMode||"clipImage",$transitionPhase:"noTransition",$general:"normal",$linkableComponent:this.props.compData.link?"link":"noLink"}},_getImageClickAction:function(){var a=this.props.compProp;var b=a.galleryImageOnClickAction;if(!b){b=a.expandEnabled===true?"zoomMode":"disabled"}return b},componentDidMount:function(){setTimeout(function(){var a;var b="androidNativeBrowserFix";if(this.isMounted()){this.setState({$showPanel:this.props.showPanelState||"notShowPanel"});if(this.props.isAndroidOldBrowser&&this.props.isMobileDevice){a=c.findDOMNode(this).classList;a.add(b);a.remove(b)}}}.bind(this),0)},componentWillReceiveProps:function(a){this.setState({$selected:a.isSelected?"selected":"unselected"})},getContainerSize:function(){var a=this.props.imageWrapperSize.imageWrapperWidth-this.getDisplayerDefaultParam(this.props.skin,"imageWrapperRight")-this.getDisplayerDefaultParam(this.props.skin,"imageWrapperLeft");var b=this.props.imageWrapperSize.imageWrapperHeight-this.getDisplayerDefaultParam(this.props.skin,"imageWrapperBottom")-this.getDisplayerDefaultParam(this.props.skin,"imageWrapperTop");if(this.getFromExports("addMarginToContainer")){a+=this.props.imageWrapperSize.imageWrapperMarginLeft+this.props.imageWrapperSize.imageWrapperMarginRight;b+=this.props.imageWrapperSize.imageWrapperMarginTop+this.props.imageWrapperSize.imageWrapperMarginBottom}return{containerWidth:a,containerHeight:b}},getSkinProperties:function(){var b=this.props.compData;var c=this.props.compProp;var d=c.alignText||"left";var e="core.components.Image";var f=this.getContainerSize();var h=f.containerWidth;var i=f.containerHeight;var j={position:"relative",overflow:"hidden"};if(this.props.browser.ie&&this.props.browser.version<=10){a.merge(j,{border:"1px solid transparent"})}return{"":{onClick:this.props.onClick,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,"data-image-index":this.props.imageIndex,"data-displayer-width":b.width,"data-displayer-height":b.height,"data-displayer-uri":b.uri,"data-height-diff":this.props.heightDiff,"data-width-diff":this.props.widthDiff,"data-bottom-gap":this.props.bottomGap,"data-image-wrapper-right":this.getDisplayerDefaultParam(this.props.skin,"imageWrapperRight"),"data-image-wrapper-left":this.getDisplayerDefaultParam(this.props.skin,"imageWrapperLeft"),"data-image-wrapper-top":this.getDisplayerDefaultParam(this.props.skin,"imageWrapperTop"),"data-image-wrapper-bottom":this.getDisplayerDefaultParam(this.props.skin,"imageWrapperBottom"),"data-margin-to-container":this.getFromExports("addMarginToContainer")},imageWrapper:{style:{height:this.props.imageWrapperSize.imageWrapperHeight,width:this.props.imageWrapperSize.imageWrapperWidth,marginLeft:this.props.imageWrapperSize.imageWrapperMarginLeft,marginRight:this.props.imageWrapperSize.imageWrapperMarginRight,marginTop:this.props.imageWrapperSize.imageWrapperMarginTop,marginBottom:this.props.imageWrapperSize.imageWrapperMarginBottom}},title:{children:b.title||"",style:n(d)},description:{children:this.parseTextIntoLinesArray(b.description)||"",style:n(d)},image:this.createChildComponent(b,e,"image",{ref:"image",id:this.props.id+"image",imageData:b,containerWidth:h>0?Math.round(h):16,containerHeight:i>0?Math.round(i):16,displayMode:g.fittingTypes.SCALE_TO_FILL,style:j}),zoom:{style:{cursor:this.getCursor()},addChildBefore:[this.generateZoomNode(),"link"]},link:{style:{display:"none"}}}},parseTextIntoLinesArray:function(c){if(!a.isString(c)){return undefined}var d=c.split(/(?:\r\n|\r|\n)/);if(d.length>1){var e=[];a.forEach(d,function a(c,f){e.push(c);if(f<d.length-1){e.push(b.createElement("br",null))}});return e}return c},onMouseEnter:function(){this.setState({$general:"rollover"})},onMouseLeave:function(){this.setState({$general:"normal"})},getCursor:function(){var a=this.props.compData;var b=this._getImageClickAction();if(b==="zoomMode"||a.link&&b==="goToLink"){return"pointer"}return"default"},getLinkData:function(){return l.renderLink(this.props.compData.link,this.props.linkRenderInfo,this.props.rootNavigationInfo)},getDisplayerDefaultParam:function(b,c){var d=this.getSkinExports();var e=h.skins[b];var f=e.paramsDefaults?e.paramsDefaults[c]:"";if(!f){var g=d[c];return g?Math.abs(parseInt(g,10)||0):0}if(Array.isArray(f)){return a.sumBy(f,function(a){return Math.abs(parseInt(this.getParamFromDefaultSkin(a).value,10))}.bind(this))}return Math.abs(parseInt(f,10))||0},generateZoomNode:function(){var c=this.props.compData;var d=this._getImageClickAction();var e={draggable:false,style:a.assign({cursor:this.getCursor(),height:"100%",display:"block",width:"100%",position:"absolute",top:"0px",left:"0px",backgroundColor:"#ffffff",filter:"alpha(opacity=0)",opacity:"0"},f.style.prefix({userSelect:"none",userDrag:"none",userModify:"read-only"})),"data-page-item-context":this.props.galleryDataId,"data-gallery-id":this.props.galleryId,onDragStart:function(a){a.preventDefault();return false}};var g={};if(d==="zoomMode"){g=l.renderImageZoomLink(this.props.linkRenderInfo,this.props.rootNavigationInfo,c,this.props.galleryDataId)}else if(c.link&&d==="goToLink"){g=this.getLinkData()}else{g={onClick:function(b){function c(a){return{id:a,timeStamp:f.performance.now(),name:f.constants.ACTION_TYPES.ITEM_CLICKED}}this.props.handleAction({type:"comp",name:f.constants.ACTION_TYPES.ITEM_CLICKED,sourceId:this.props.galleryId,pageId:this.props.rootId},c(a.get(this.props,"compData.id")||this.props.id));b.preventDefault();b.stopPropagation()}.bind(this)}}a.merge(e,g);return b.DOM.a(e)},setPanelState:function(a){this.setState({$showPanel:a})},getPanelState:function(){return this.state.$showPanel},setTransitionPhase:function(a){this.setState({$transitionPhase:a})}}});
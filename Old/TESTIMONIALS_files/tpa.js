define("tpa/bi/errors.json",[],function(){return{SDK_SET_HEIGHT_ERROR:{errorCode:190,desc:"sdk - set height with a big number",severity:"error",params:{p1:"height"}},SDK_PUBSUB_PUBLISH_ERROR:{errorCode:191,desc:"sdk - pubSub: publish error. App not installed on site - cannot find appDefId",severity:"error"},SDK_NAVIGATION_TO_SECTION_ERROR:{errorCode:192,desc:"sdk - navigate to section failed",severity:"error",params:{p1:"appDefinitionName",p2:"sectionId"}},ECOM_MISSING_PAGES:{errorCode:300,desc:"missing ecom pages",severity:"error"},APP_IS_NOT_RESPONSIVE:{errorCode:302,desc:"monitoring apps that are down",severity:"error",params:{p1:"endpoint",p2:"app_id"}}}});define("tpa/bi/errors",["tpa/bi/errors.json","lodash","utils"],function(a,b,c){"use strict";var d=c.logger;b.forEach(a,function(a,b){a.errorName=b});d.register("tpa","error",a);return a});define("tpa/utils/tpaUtils",["lodash","coreUtils"],function(a,b){"use strict";var c="TPA_PUB_SUB_";var d=function(a,b){var c=a.getComponentById(b);var d=c&&a.getSiteData().getClientSpecMapEntry(c.props.compData.applicationId);return d};var e=function(a){return a.getSiteData().getClientSpecMap()};var f=function(a,b){var c=d(a,b);return c?c.appDefinitionId:null};var g=function(a){var b=new RegExp("^"+c);return a.replace(b,"")};var h=function(a){return c.concat(a)};var i=function(b){var c=a.get(b,"props.structure.componentType");return c==="wysiwyg.viewer.components.tpapps.TPASection"||c==="wysiwyg.viewer.components.tpapps.TPAMultiSection"};var j=function(b,c){b=b||"0.0.0";c=c||"1.41.0";var d=a.map(b.split("."),function(a){return parseInt(a,10)});var e=a.map(c.split("."),function(a){return parseInt(a,10)});if(d.length===3&&e.length===3){return d[0]>=e[0]&&d[1]>=e[1]&&d[2]>=e[2]}return false};var k=function(b){var c=b.cookieUtils.getCookie("_wixUIDX")||"";c=c.slice(a.lastIndexOf(c,"|")+1);c=c.replace(/^(null-user-id|null)$/g,"");return c};var l=function(a,b){var c=e(a);var d=c[b]&&c[b].instance.split(".")[1];return d&&JSON.parse(window.atob(d))};var m=0;var n=function(){++m};var o=function(a,b){--m;p(a,b)};var p=function(){if(m===0){m=1e3}};var q=function(b,c){if(b&&c){if(a.includes(c,"$TPA$")){c=c.substr(0,c.indexOf("$TPA$"))}var d=a.find(b.widgets,function(b){return a.get(b,"appPage.id")===c});if(d){return a.get(d,"appPage.hideFromMenu")}return false}return false};return{Constants:{TPA_PUB_SUB_PREFIX:c,TOP_PAGE_ANCHOR_PREFIX:"TOP_PAGE_"},getCacheKiller:b.urlUtils.persistentCacheKiller,getAppData:d,getAppDefId:f,stripPubSubPrefix:g,addPubSubEventPrefix:h,isTPASection:i,sdkVersionIsAtLeast:j,getVisitorUuid:k,getInstance:l,getClientSpecMap:e,incAppCounter:n,decAppCounter:o,reportAppCounter:p,isPageMarkedAsHideFromMenu:q}});define("tpa/services/clientSpecMapService",["lodash","tpa/utils/tpaUtils"],function(a,b){"use strict";var c=function(b){var c=b.widgets;if(c){return a.find(c,function(a){return a.appPage&&a.appPage.name&&!a.appPage.hidden})}return undefined};var d=function(c,d){var e=b.getAppData(c,d);return a.get(e,"isWixTPA")};return{getMainSectionWidgetData:c,isSuperAppByCompId:d}});define("tpa/bi/events.json",[],function(){return{JS_SDK_FUNCTION_CALL:{eventId:12,adapter:"sdk",src:11,sampleRatio:1,params:{visitor_id:"visitorUuid",ver:"sdkVersion",origin:"origin",function_name:"fnName",namespace:"namespace",app_id:"appId",instance_id:"instanceId",is_published:"isPublished",count:"count"}},GALLERY_FUNCTION_CALL:{eventId:11,adapter:"sdk",src:11,params:{visitor_id:"visitorUuid",sdk_ver:"sdkVersion",origin:"origin",function_name:"fnName",namespace:"namespace",count:"count"}},APP_IFRAME_START_LOADING:{eventId:642,src:42,params:{widget_id:"widgetId",instance_id:"compId",appId:"appDefinitionId"}},APP_LOADED_SUCCESSFULLY:{eventId:643,src:42,params:{widget_id:"widgetId",instance_id:"compId",appId:"appDefinitionId",loading_time:"loadingTime"}},APP_LOADED_PARTIALLY:{eventId:644,src:42,params:{widget_id:"widgetId",instance_id:"compId",appId:"appDefinitionId",loading_time:"loadingTime",stage:"stage",stage_number:"stageNum"}},APP_SDK_START_LOADING:{eventId:645,src:42,params:{widget_id:"widgetId",instance_id:"compId",appId:"appDefinitionId",loading_time:"loadingTime"}}}});define("tpa/bi/events",["tpa/bi/events.json","lodash","utils"],function(a,b,c){"use strict";var d=c.logger;d.register("tpa","event",a);return a});define("tpa/mixins/tpaCompBaseMixin",["zepto","lodash","reactDOM","santaProps","tpa/bi/errors","tpa/services/clientSpecMapService","tpa/utils/tpaUtils","tpa/bi/events","experiment"],function(a,b,c,d,e,f,g,h,i){"use strict";var j={mobile:"unavailableInMobile",https:"unavailableInHttps"};var k=function(d,e){var f=c.findDOMNode(d),g=a(f).offset();return b.assign({scrollTop:window.document.body.scrollTop||window.document.documentElement.scrollTop,scrollLeft:window.document.body.scrollLeft||window.document.documentElement.scrollLeft,documentHeight:a(window.document.body).height(),documentWidth:a(window.document.body).width(),x:g.left,y:g.top,scale:e},f.getBoundingClientRect())};var l=function(a,b){var c={charCode:a.charCode,keyCode:a.keyCode};this.sendPostMessage({intent:"addEventListener",eventType:b,params:c})};var m=function(){return b.includes(this.props.getRootIdsWhichShouldBeRendered(),this.props.rootId)};return{propTypes:{isMobileView:d.Types.isMobileView,isViewerMode:d.Types.isViewerMode,currentUrl:d.Types.currentUrl.isRequired,compData:d.Types.Component.compData.isRequired,style:d.Types.Component.style.isRequired,id:d.Types.Component.id.isRequired,siteMembersAspect:d.Types.SiteAspects.siteMembers.isRequired,reportBI:d.Types.reportBI.isRequired,getPrimaryPageId:d.Types.getPrimaryPageId.isRequired,getRootIdsWhichShouldBeRendered:d.Types.getRootIdsWhichShouldBeRendered,reportBeatEvent:d.Types.reportBeatEvent.isRequired,santaBase:d.Types.santaBase.isRequired,getClientSpecMapEntry:d.Types.getClientSpecMapEntry.isRequired,languageCode:d.Types.RendererModel.languageCode,pageId:d.Types.Component.pageId,rootId:d.Types.Component.rootId,structure:d.Types.Component.structure,siteScale:d.Types.RenderFlags.siteScale},ALIVE_TIMEOUT:2e4,OVERLAY_GRACE:5e3,scrollDataQueue:[],onScroll:function(){if(m.call(this)){var a=b.get(this,"props.siteScale",1);var c=k(this,a);var d=this;d.scrollDataQueue.push(c);b.delay(function(){if(!b.isEmpty(d.scrollDataQueue)){var a=d.scrollDataQueue.pop();d.scrollDataQueue=[];d.sendPostMessage({intent:"addEventListener",eventType:"SCROLL",params:a})}},250)}},onKeyDown:function(a){if(m.call(this)){l.call(this,a,"KEY_DOWN")}},onKeyUp:function(a){if(m.call(this)){l.call(this,a,"KEY_UP")}},isUnderMobileView:function(){return this.props.isMobileView},getEcomParams:function(){var a=this.getAppData();return a.appDefinitionId==="1380b703-ce81-ff05-f115-39571d94dfcd"&&this.props.currentUrl.query["ecom-tpa-params"]},_createOverlayChildComponent:function(a,c,d,e){e=e||{};return this.createChildComponent(b.merge(e,{id:d,style:this.props.style,overlay:c,applicationId:this.props.compData.applicationId,hideOverlayFunc:this._hideOverlay,compData:this.props.compData,languageCode:this.props.languageCode,santaBase:this.props.santaBase,getClientSpecMapEntry:this.props.getClientSpecMapEntry}),a,d,{})},_hideOverlay:function(){this.setState({showOverlay:false})},_createOverlay:function(a){if(!a){return null}switch(a){case"preloader":return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAPreloaderOverlay",a,"preloaderOverlay");case"unresponsive":return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",a,"unavailableMessageOverlay",{text:"We're sorry, this content cannot be displayed. Please try again later."});case j.https:return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",a,"unavailableMessageOverlay",{text:"We're sorry, this content cannot be displayed."});case j.mobile:return this._createOverlayChildComponent("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",a,"unavailableMessageOverlay",{text:"We're sorry, this content is currently not optimized for mobile view."});default:return null}},getRootStyle:function(a){return b.assign({minHeight:a.height,minWidth:a.width,visibility:this.state.visibility},a)},getCompRootStyle:function(a){if(this.state&&!b.isUndefined(this.state.height)){a.height=this.state.height}if(this.state&&!b.isUndefined(this.state.width)){a.width=this.state.width}if(this.state&&(this.state.isAlive||this.state.overlay==="preloader"||this.state.overlay==="unresponsive"||this.state.overlay===j.mobile)){this.state.visibility="visible"}if(this.state.ignoreAnchors){a.zIndex=1001}else{a.zIndex=""}a=this.getRootStyle(a);return a},shouldRenderIframe:function(){var a=this.state.overlay;var c=!b.includes(j,a);var d=this.state.overlay==="unresponsive";var e=c&&!d;return e},_getIframeProperties:function(){if(!this.shouldRenderIframe()){return null}var a=this._shouldShowIframe(this.state);var b=this.buildUrl(this.getBaseUrl());return{src:b,key:b,scrolling:"no",frameBorder:"0",allowTransparency:true,allowFullScreen:true,name:this.props.id,style:{display:a?"block":"none",width:"100%",height:"100%",overflow:"hidden",position:"absolute"}}},getSkinProperties:function(){var a=this._createOverlay(this.state.overlay);var b=this._getIframeProperties();var c={"":{style:this.getCompRootStyle(this.props.style),"data-ignore-anchors":this.state.ignoreAnchors},overlay:this.state.showOverlay&&this.isNotWorker()?a:null,iframe:b?b:"remove"};this.checkIfNeedToSendMemberData();if(this.mutateSkinProperties){c=this.mutateSkinProperties(c)}return c},checkIfNeedToSendMemberData:function(){var a=this.state.shouldGetSiteMemberDetails;if(a){var b=this.props.siteMembersAspect;var c=b.getMemberDetails();if(c){a.callback({authResponse:true,data:c})}}},getInitialState:function(){this.startLoadingTime=b.now();this.reportPerformanceBiEvent(h.APP_IFRAME_START_LOADING);this.urlState="";var a=this.isUnderMobileView()&&this.isMobileReady&&!this.isMobileReady();var c=a?j.mobile:null;var d={visibility:"hidden",overlay:c,isAlive:false,registeredEvents:[],showOverlay:true,initialWidth:this.props.style.width,initialHeight:this.props.style.height};if(this.mutateInitialState){d=this.mutateInitialState(d)}return d},_showOverlayIfNeeded:function(){if(this.state&&this.state.isAlive===false&&!this.state.overlay){this.setState({overlay:this._getInitialOverlay(),visibility:"visible"})}},_shouldShowIframe:function(a){return!a.overlay||a.overlay==="preloader"},_getInitialOverlay:function(){if(this.isMobileReady&&this.isUnderMobileView()&&!this.isMobileReady()){return j.mobile}return"preloader"},componentWillReceiveProps:function(a){if(this.resize){this.resize(a)}},componentDidMount:function(){var a=this.state.overlay;if(this.isNotWorker()){setTimeout(this._showOverlayIfNeeded,this.OVERLAY_GRACE);if(!this.props.isViewerMode){if(this.setOverlayState){this.setOverlayState()}}}if(!(this.state.isAlive||b.includes(j,a))&&this.isNotWorker()){this._appAliveTimeout=setTimeout(this._onAppAliveTimeoutExpires,this.ALIVE_TIMEOUT);g.incAppCounter()}},isNotWorker:function(){if(this.isTPAWorker){return!this.isTPAWorker()}return true},_onAppAliveTimeoutExpires:function(){this.showUnresponsiveOverlay()},showUnresponsiveOverlay:function(){if(!this.state.isAlive){this.setState({overlay:"unresponsive",visibility:"visible"},function(){this.reportBIAppNotResponsive()}.bind(this))}},reportBIAppNotResponsive:function(){var a=this.props.compData.widgetId;var c=this.getAppData();var d=a?b.get(c.widgets,a):f.getMainSectionWidgetData(c);var g={endpoint:b.get(d,"widgetUrl"),app_id:b.get(c,"appDefinitionId")};this.props.reportBI(e.APP_IS_NOT_RESPONSIVE,g)},componentWillUnmount:function(){this._clearAliveTimeout()},_clearAliveTimeout:function(){if(this._appAliveTimeout){clearTimeout(this._appAliveTimeout);this._appAliveTimeout=0;if(this.props){g.decAppCounter(this.props.reportBeatEvent,this.props.getPrimaryPageId())}}},setAppIsAlive:function(a){this.reportPerformanceBiEvent(h.APP_SDK_START_LOADING);this._clearAliveTimeout();this.setState({isAlive:true,overlay:this.state.overlay==="preloader"?null:this.state.overlay},a)},_isUrlSecure:function(a){return/^https/.test(a)},reportPerformanceBiEvent:function(a,c){if(i.isOpen("sv_tpaPerformanceBi")){var d=this.getAppData();var e=b.get(this.props,"compData.widgetId");if(!e){var g=f.getMainSectionWidgetData(d);e=b.get(g,"widgetId")}var h={widgetId:e,appDefinitionId:b.get(d,"appDefinitionId"),compId:this.props.id};b.merge(h,c);if(b.get(a,"params.loading_time")){h.loadingTime=b.now()-this.startLoadingTime}this.props.reportBI(a,h)}}}});define("tpa/common/TPABaseUrlBuilder",["lodash","utils"],function(a,b){"use strict";var c=function(a){this.url=b.urlUtils.parseUrl(a);this.url.query=this.url.query||{};this.url.search=null};c.prototype={addQueryParam:function(b,c){var d=this.url.query;if(c&&!a.isEmpty(c)){if(!d[b]){d[b]=c}else if(a.isArray(d[b])){d[b].push(c)}else{d[b]=[d[b],c]}}return this},addMultipleQueryParams:function(b){if(b&&!a.isEmpty(b)){a.assign(this.url.query,b)}return this},mutateIframeSrc:function(a){if(a){this.url=a(this.url)}return this},filterQueryParams:function(b){if(b&&!a.isEmpty(b)){this.url.query=a.pick(this.url.query,b)}return this},build:function(){return b.urlUtils.buildFullUrl(this.url)}};return c});define("tpa/common/TPAUrlBuilder",["lodash","utils","tpa/common/TPABaseUrlBuilder"],function(a,b,c){"use strict";var d=function(a){c.call(this,a)};d.prototype=a.assign(new c,{addCacheKiller:function(a){return this.addQueryParam("cacheKiller",a)},addInstance:function(a){return this.addQueryParam("instance",a)},addWidth:function(a){return this.addQueryParam("width",a)},addLocale:function(a){return this.addQueryParam("locale",a)},addViewMode:function(a){return this.addQueryParam("viewMode",a)},addCompId:function(a){return this.addQueryParam("compId",a)},addDeviceType:function(a){return this.addQueryParam("deviceType",a)},addEndpointType:function(a){return this.addQueryParam("endpointType",a)},addOrigCompId:function(a){return this.addQueryParam("origCompId",a)},addExternalId:function(a){return this.addQueryParam("externalId",a)},addOrigin:function(a){return this.addQueryParam("origin",a)},addPageId:function(a){return this.addQueryParam("pageId",a)},addHeight:function(a){return this.addQueryParam("height",a)},addViewerSessionId:function(a){return this.addQueryParam("vsi",a)}});return d});define("tpa/mixins/tpaUrlBuilderMixin",["lodash","utils","santaProps","tpa/utils/tpaUtils","tpa/common/TPAUrlBuilder"],function(a,b,c,d,e){"use strict";var f=function(a,b){if(a.mutateIframeUrlQueryParam){b=a.mutateIframeUrlQueryParam(b)}return b};var g=function(c){var d=/^https?/.test(c);if(!d){var e=this.props.getCurrentUrl();var f=e&&b.urlUtils.parseUrl(e);var g=a.get(f,"protocol","http:");return b.urlUtils.addProtocolIfMissing(c,g)}return c};return{propTypes:{id:c.Types.Component.id.isRequired,isViewerMode:c.Types.isViewerMode,componentViewMode:c.Types.RenderFlags.componentViewMode,languageCode:c.Types.RendererModel.languageCode,compData:c.Types.Component.compData.isRequired,getCurrentUrl:c.Types.getCurrentUrl.isRequired,rootId:c.Types.Component.rootId,viewerSessionId:c.Types.viewerSessionId},getInitialState:function(){this.viewMode=this.getViewMode()},getViewMode:function(){return this.props.isViewerMode?"site":this.props.componentViewMode},buildUrl:function(b,c){var h=this.state.queryParams||{};h=a.merge(h,f(this,h));if(this.getEcomParams&&this.getEcomParams()){h["ecom-tpa-params"]=this.getEcomParams()}b=g.call(this,b);var i=this.state.initialHeight?this.state.initialHeight.toString():undefined;var j=new e(b).addCompId(this.props.id).addDeviceType(this.getDeviceType(this)).addInstance(this.getAppData(this).instance).addLocale(this.props.languageCode).addViewMode(this.viewMode).addCacheKiller(d.getCacheKiller()).addExternalId(this.props.compData.referenceId).addPageId(this.props.rootId).addHeight(i).filterQueryParams(c).addMultipleQueryParams(h).addViewerSessionId(this.props.viewerSessionId);if(this.mutateIframeSrc){j.mutateIframeSrc(this.mutateIframeSrc)}return j.build()}}});define("tpa/mixins/tpaCompApiMixin",["lodash","reactDOM","santaProps"],function(a,b,c){"use strict";return{propTypes:{id:c.Types.Component.id.isRequired,clientSpecMap:c.Types.RendererModel.clientSpecMap.isRequired,compData:c.Types.Component.compData.isRequired,isMobileView:c.Types.isMobileView,tpaPostMessageAspect:c.Types.SiteAspects.tpaPostMessageAspect.isRequired,windowScrollEvent:c.Types.SiteAspects.windowScrollEvent.isRequired,windowKeyboardEvent:c.Types.SiteAspects.windowKeyboardEvent.isRequired,tpaPageNavigationAspect:c.Types.SiteAspects.tpaPageNavigationAspect.isRequired,svSessionChangeEvent:c.Types.SiteAspects.svSessionChangeEvent.isRequired,tpaPubSubAspect:c.Types.SiteAspects.tpaPubSubAspect.isRequired,siteMetadataChangeAspect:c.Types.SiteAspects.siteMetadataChangeAspect.isRequired},SUPPORTED_SITE_EVENTS:{SCROLL:"SCROLL",PAGE_NAVIGATION:"PAGE_NAVIGATION",PAGE_NAVIGATION_IN:"PAGE_NAVIGATION_IN",PAGE_NAVIGATION_OUT:"PAGE_NAVIGATION_OUT",PAGE_NAVIGATION_CHANGE:"PAGE_NAVIGATION_CHANGE",STATE_CHANGED:"STATE_CHANGED",SESSION_CHANGED:"SESSION_CHANGED",SITE_METADATA_CHANGED:"SITE_METADATA_CHANGED",KEY_DOWN:"KEY_DOWN",KEY_UP:"KEY_UP"},isEventSupported:function(a){return!!this.SUPPORTED_SITE_EVENTS[a]},isCompListensTo:function(b){return a.includes(this.state.registeredEvents,b)},getAppData:function(){return this.props.clientSpecMap[this.props.compData.applicationId]||{}},getDeviceType:function(){return this.props.isMobileView?"mobile":"desktop"},sendPostMessage:function(a){this.props.tpaPostMessageAspect.sendPostMessage(this,a)},getIframe:function(){return this.refs.iframe&&b.findDOMNode(this.refs.iframe)},startListen:function(b){if(this.isEventSupported(b)){this.setState({registeredEvents:this.state.registeredEvents.concat(b)});if(this.props){if(a.includes(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION)||a.includes(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION_CHANGE)){this.props.tpaPageNavigationAspect.registerToPageChanged(this,b)}switch(b){case this.SUPPORTED_SITE_EVENTS.SCROLL:this.props.windowScrollEvent.registerToScroll(this);break;case this.SUPPORTED_SITE_EVENTS.SESSION_CHANGED:this.props.svSessionChangeEvent.registerToSessionChanged(this);break;case this.SUPPORTED_SITE_EVENTS.SITE_METADATA_CHANGED:this.props.siteMetadataChangeAspect.registerToSiteMetadataChange(this);break;case this.SUPPORTED_SITE_EVENTS.KEY_DOWN:this.props.windowKeyboardEvent.registerToKeyDown(this);break;case this.SUPPORTED_SITE_EVENTS.KEY_UP:this.props.windowKeyboardEvent.registerToKeyUp(this);break}}}},stopListen:function(b){this.setState({registeredEvents:a.without(this.state.registeredEvents,b)});if(this.props){if(a.includes(b,this.SUPPORTED_SITE_EVENTS.PAGE_NAVIGATION)){this.props.tpaPageNavigationAspect.unregisterToPageChanged(this)}switch(b){case this.SUPPORTED_SITE_EVENTS.SCROLL:this.props.windowScrollEvent.unregisterToScroll(this,b);break;case this.SUPPORTED_SITE_EVENTS.SESSION_CHANGED:this.props.svSessionChangeEvent.unRegisterToSessionChanged(this);break;case this.SUPPORTED_SITE_EVENTS.SITE_METADATA_CHANGED:this.props.siteMetadataChangeAspect.unRegisterToSiteMetadataChange(this);break;case this.SUPPORTED_SITE_EVENTS.KEY_DOWN:this.props.windowKeyboardEvent.unRegisterKeyDown(this);break;case this.SUPPORTED_SITE_EVENTS.KEY_UP:this.props.windowKeyboardEvent.unRegisterKeyUp(this);break}}},setSiteMemberDataState:function(a){this.setState({shouldGetSiteMemberDetails:a})},hasOrigComponent:function(){return!a.isUndefined(this.props.compData.origCompId)},setQueryParams:function(b){if(a.isObject(b)){this.setState({queryParams:b})}},componentWillUnmount:function(){var a=this.props.id;var b=this.getAppData().appDefinitionId;this.props.tpaPubSubAspect.deleteCompListeners(b,a)}}});define("tpa/mixins/tpaWidgetMixin",["santaProps"],function(a){"use strict";return{propTypes:{compData:a.Types.Component.compData.isRequired},getBaseUrl:function(){var a=this.getAppData();if(a.widgets){var b=this.props.compData.widgetId;var c=a.widgets[b];if(c){var d=this.isInMobileDevMode&&this.isInMobileDevMode();if(this.isUnderMobileView()){var e=c.mobileUrl&&(d||c.mobilePublished);return e?c.mobileUrl:c.widgetUrl}return c.widgetUrl}}return""}}});define("tpa/mixins/tpaResizeWindowMixin",["lodash"],function(a){"use strict";function b(b){return a.isString(b)&&/^[0-9]+%$/.test(b)}function c(c){return a.isNumber(c)&&c>=0||b(c)}return{resizeWindow:function(a,b,d){var e={};this.registerReLayout();if(c(b)){e.height=b}if(c(a)){e.width=a}this.setState(e,d)}}});define("tpa/components/tpaWidget",["lodash","core","santaProps","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaWidgetMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g,h){"use strict";var i=b.compRegistrar;var j=b.compMixins;var k={displayName:"TPAWidget",propTypes:{structure:c.Types.Component.structure.isRequired},statics:{useSantaTypes:true},mixins:[j.skinBasedComp,j.timeoutsMixin,d,e,f,g,h],mutateIframeUrlQueryParam:function(b){b.width=this.state.initialWidth;var c=this.props.structure.originCompId;if(c&&!a.isEmpty(c)){b.originCompId=c}return b}};i.register("wysiwyg.viewer.components.tpapps.TPAWidget",k,true);return k});define("tpa/mixins/tpaSectionMixin",["lodash","santaProps"],function(a,b){"use strict";return{propTypes:{getExistingRootNavigationInfo:b.Types.getExistingRootNavigationInfo,rootId:b.Types.Component.rootId.isRequired,getPageUrl:b.Types.getPageUrl.isRequired,pageId:b.Types.Component.pageId,compData:b.Types.Component.compData.isRequired,isViewerMode:b.Types.isViewerMode,currentUrlPageId:b.Types.Component.currentUrlPageId},isTPASection:true,getSiteAdditionalDataFromProps:function(a){var b=a.getExistingRootNavigationInfo(a.rootId);return b&&b.pageAdditionalData||""},mutateSkinProperties:function(a){if(typeof a.iframe==="object"){a.iframe.src=this.buildUrl(this.getBaseUrl())}return a},mutateInitialState:function(a){a.sectionUrlState=this.getSiteAdditionalDataFromProps(this.props);a.sectionUrl=this.fixSectionUrl();return a},fixSectionUrl:function(){var a=this.props.getPageUrl(true);return this.endsWith(a,"/")?a:a+"/"},endsWith:function(b,c){return a.endsWith(b,c)},isViewerMode:function(){return this.getViewMode()==="site"},componentWillReceiveProps:function(b){var c=this.getSiteAdditionalDataFromProps(b);if(!a.isUndefined(this.state.pushState)){this.urlState=this.state.pushState;this.setState({pushState:undefined})}else if(b.currentUrlPageId===this.props.pageId&&this.isViewerMode()){if(this.urlState!==c||this.shouldUpdateState){this.urlState=c;this.shouldUpdateState=false;this.setState({sectionUrlState:c})}}this.reportStateChanged(c)},reportStateChanged:function(a){if(this.isCompListensTo(this.SUPPORTED_SITE_EVENTS.STATE_CHANGED)){this.sendPostMessage({intent:"addEventListener",eventType:"STATE_CHANGED",params:{newState:a}})}},isMobileReady:function(){var b=this.getAppData();var c=this.isInMobileDevMode&&this.isInMobileDevMode();var d=this.props.compData;var e=a.get(b,"widgets");if(e&&d.widgetId){var f=e[d.widgetId];return f.mobileUrl&&(c||f.mobilePublished)}return b.sectionMobileUrl&&(c||b.sectionMobilePublished)},mutateIframeUrlQueryParam:function(a){if(this.props.isViewerMode){a["section-url"]=this.fixSectionUrl();a.target="_top"}else{a["section-url"]=this.getBaseUrl();a.target="_self"}a.width=this.state.initialWidth;return a},mutateIframeSrc:function(a){a=this.addStateToUrlObj(a,this.state.sectionUrlState);return a},addStateToUrlObj:function(a,b){if(b){var c=b.charAt(0)==="#";if(c){a.hash=b}else{if(a.path&&a.path.slice(-1)!=="/"){a.path+="/"}a.path+=b}}return a}}});define("tpa/components/tpaSection",["lodash","core","santaProps","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaSectionMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g,h){"use strict";var i=b.compRegistrar;var j=b.compMixins;var k={displayName:"TPASection",propTypes:{compData:c.Types.Component.compData.isRequired},statics:{useSantaTypes:true},mixins:[j.skinBasedComp,j.timeoutsMixin,d,e,f,g,h],getBaseUrl:function(){var b=this.getAppData();var c=this.props.compData.widgetId;var d=b.sectionUrl;var e=b.sectionDefaultPage;var f=this.props.compData.type;var g=this.isUnderMobileView()&&this.isMobileReady();if(f==="TPAWidget"&&c){var h=a.find(b.widgets,{widgetId:c});if(h){e=h.appPage.defaultPage;if(g){d=h.mobileUrl}else{d=h.widgetUrl}}}else if(g){d=b.sectionMobileUrl}if(e&&!a.isEmpty(e)){if(d.slice(-1)!=="/"){d+="/"}d+=e}return d}};i.register("wysiwyg.viewer.components.tpapps.TPASection",k,true);return k});define("tpa/components/tpaMultiSection",["lodash","core","santaProps","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaSectionMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g,h){"use strict";var i=b.compRegistrar;var j=b.compMixins;var k={displayName:"TPAMultiSection",propTypes:{compData:c.Types.Component.compData.isRequired},statics:{useSantaTypes:true},mixins:[j.skinBasedComp,j.timeoutsMixin,d,e,f,g,h],getBaseUrl:function(){var b=this.getAppData();var c=b.sectionUrl;var d=b.widgets[this.props.compData.widgetId];var e=b.sectionDefaultPage;if(d){if(this.isUnderMobileView()&&this.isMobileReady()){c=d.mobileUrl}else{c=d.widgetUrl}e=d.appPage.defaultPage}if(e&&!a.isEmpty(e)){if(c.slice(-1)!=="/"){c+="/"}c+=e}return c}};i.register("wysiwyg.viewer.components.tpapps.TPAMultiSection",k,true);return k});define("tpa/components/tpaWorker",["core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin"],function(a,b,c,d){"use strict";var e=a.compRegistrar;var f=a.compMixins;var g={displayName:"TPAWorker",mixins:[f.skinBasedComp,b,c,d],statics:{useSantaTypes:true},getBaseUrl:function(){var a=this.getAppData();return a.appWorkerUrl},mutateIframeUrlQueryParam:function(a){a.endpointType="worker";return a},mutateSkinProperties:function(a){if(a.iframe&&a.iframe.style){a.iframe.style.display="none"}return a},isTPAWorker:function(){return true}};e.register("tpa.viewer.classes.TPAWorker",g)});define("tpa/components/tpaGluedWidget",["core","tpa/mixins/tpaCompBaseMixin","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaWidgetMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f){"use strict";var g=a.compRegistrar;var h=a.compMixins;var i={displayName:"TPAGluedWidget",statics:{useSantaTypes:true},mixins:[h.skinBasedComp,h.timeoutsMixin,b,c,d,e,f],mutateIframeUrlQueryParam:function(a){a.width=this.state.initialWidth;return a}};g.register("wysiwyg.viewer.components.tpapps.TPAGluedWidget",i,true);return i});define("tpa/aspects/TPAWorkerAspect",["lodash","compUtils","santaProps"],function(a,b,c){"use strict";var d=function(a){return{componentType:"tpa.viewer.classes.TPAWorker",skin:"wysiwyg.viewer.skins.TPAWidgetSkin",type:"Component",id:a}};var e=function(a,e,f){var g="tpaWorker_"+f.applicationId;var h=d(g);var i=c.componentPropsBuilder.getCompProps(h,a,null,e);i.compData=f;return b.compFactory.getCompClass(h.componentType)(i)};function f(a){this._aspectSiteAPI=a}f.prototype={getComponentStructures:function(){var b=[];var c=this._aspectSiteAPI.getSiteData().getClientSpecMap();var e=this.getTPAWorkers(c);if(!a.isEmpty(e)){var f=d();b.push(f)}return b},getTPAWorkers:function(b){var c=a.filter(b,function(b){return a.isString(b.appWorkerUrl)&&b.permissions&&!b.permissions.revoked});return c},getReactComponents:function(b){var c=this._aspectSiteAPI.getSiteData().getClientSpecMap();var d=this._aspectSiteAPI.getSiteAPI();var f=this.getTPAWorkers(c);var g=[];a.forEach(f,function(a){var c=e(d,b,a);g.push(c)});return g}};return f});define("tpa/common/tpaPostMessageCommon",["lodash"],function(a){"use strict";var b={TPA_MESSAGE:"TPA",TPA_MESSAGE_PREVIEW:"TPA_PREVIEW",TPA_MESSAGE2:"TPA2",TPA_RESPONSE:"TPA_RESPONSE",TPA_PREVIEW_RESPONSE:"TPA_PREVIEW_RESPONSE",PINGPONG_PREFIX:"pingpong:"};var c=function(a,b){var c={getSectionUrl:true,siteInfo:true,navigateToPage:true,getExternalId:true,smRequestLogin:true,getValue:true,getValues:true,getCurrentPageAnchors:true,getComponentInfo:true,navigateToSectionPage:true,getStateUrl:true,getSitePages:true,getSiteMap:true};return!(a==="preview"&&c[b.type])};var d=function(b){return b.getSiteData().viewMode==="preview"&&a.get(window,"documentServices.tpa.__privates.areDocumentServicesHandlersReady")&&window.documentServices.tpa.__privates.areDocumentServicesHandlersReady()};var e=function(a,b,c){var d="";try{d=JSON.stringify(b)}catch(a){return}if(!a.postMessage){a=a.contentWindow}a.postMessage(d,c||"*")};var f=function(a,c,d){return function(f){try{e(a,{intent:d||b.TPA_RESPONSE,callId:c.callId,type:c.type,res:f,status:true})}catch(a){}}};var g=function a(c){return c===b.TPA_MESSAGE||c===b.TPA_MESSAGE2};var h=function a(c){return c===b.TPA_MESSAGE_PREVIEW};var i=function(a){return a.replace(b.PINGPONG_PREFIX,"")};var j=function(a){return a.getSiteData().viewMode};var k=function(a,e,i,k){var l;try{if(k.data){l=JSON.parse(k.data)}else if(k.originalEvent&&k.originalEvent.data){k=k.originalEvent;l=JSON.parse(k.data)}}catch(a){return}if(l&&g(l.intent)){var m=j(e);if(a){i(a,e,l,f(k.source,l))}else if(c(m,l)||!d(e)){l.origin=m==="site"?"viewer":m;i(e,l,f(k.source,l))}}else if(l&&h(l.intent)){if(a){i(a,e,l,f(k.source,l,b.TPA_PREVIEW_RESPONSE))}else{i(e,l,f(k.source,l,b.TPA_PREVIEW_RESPONSE))}}};return{Intents:b,callPostMessage:e,generateResponseFunction:f,isTPAMessage:g,fixOldPingPongMessageType:i,handleTPAMessage:k}});define("tpa/utils/sitePages",["lodash","utils","siteUtils","coreUtils","tpa/utils/tpaUtils"],function(a,b,c,d,e){"use strict";var f=function(c,d){d=d||{};var e=b.menuUtils.getSiteMenuWithoutRenderedLinks(c,false);if(d.filterHideFromMenuPages){e=g(e,c.getClientSpecMap())}d.homePageId=c.getMainPageId();var f=n(e,c,d);if(d.includeIsHomePage){f=k(f,d.homePageId)}if(d.includePagesUrl){f=i(c,f,a.get(d,"baseUrl"),d)}return f};var g=function(b,c){return a.filter(b,function(a){return!j(c,a.link)})};function h(a,c,d,e){return b.wixUrlParser.getUrl(a,{pageId:c,title:d},undefined,true,e)}var i=function(b,c,d){return a.map(c,function(a){var c=b.getDataByQuery(a.id,"masterPage");if(c&&c.pageUriSEO){a.url=h(b,a.id,c.pageUriSEO,d)}if(a.subPages){a.subPages=i(b,a.subPages,d)}return a})};var j=function(b,c){if(a.get(c,"type")==="PageLink"){var d=a.get(c,"pageId.tpaApplicationId");var f=a.get(c,"pageId.tpaPageId");var g=a.get(b,d);return e.isPageMarkedAsHideFromMenu(g,f)}return false};var k=function(b,c){return a.map(b,function(a){a.isHomepage=l(a,c);if(a.subPages){a.subPages=k(a.subPages,c)}return a})};var l=function(b,c){return!a.isUndefined(b)&&b.id===c};var m=function(a){var b=f(a);return v(b,a)};var n=function(b,c,d){var e=[];var f=d.enhancedInfo?s:o;a.forEach(b,function(b){var g=f(b,c,d);var h=b.items;a.forEach(h,function(a){var b=f(a,c,d);g.subPages=g.subPages||[];g.subPages.push(b)});e.push(g)});return e};var o=function(c){if(c.link){var d=a.get(c.link,"pageId.id");return{title:c.label||"",id:b.stringUtils.startsWith(d,"#")?d.substr(1):d,hide:!c.isVisible||false}}return{}};var p=function(b){var c=a.get(b,"link.anchorDataId.compId");if(!c){var e=a.get(b,"link.anchorDataId");if(e===d.siteConstants.PAGE_ANCHORS.TOP_ANCHOR_ID){c=d.siteConstants.PAGE_ANCHORS.TOP_ANCHOR_COMP_ID}else if(e===d.siteConstants.PAGE_ANCHORS.BOTTOM_ANCHOR_ID){c=d.siteConstants.PAGE_ANCHORS.BOTTOM_ANCHOR_COMP_ID}}return c};var q=function(c){var d=a.get(c,"link.pageId.id");if(d){return b.stringUtils.startsWith(d,"#")?d.substr(1):d}return""};var r=function(b,c,d){var e=q(b);var f=a.get(b,"link.pageId.pageUriSEO");var g={pageId:e,isHomePage:e===d.homePageId};if(f){g.url=h(c,e,f,d.baseUrl)}return g};var s=function(b,d,e){var f={type:t(b.link),title:b.label||"",hidden:!b.isVisible||false};var g=a.get(b,"link.type");switch(g){case"PageLink":f.page=r(b,d,e);break;case"AnchorLink":f.anchor={
name:a.get(b,"link.anchorName"),anchorId:p(b)};a.merge(f.anchor,r(b,d,e));break;case"ExternalLink":f.website={websiteUrl:a.get(b,"link.url"),target:a.get(b,"link.target")};break;case"EmailLink":f.email={address:a.get(b,"link.recipient"),subject:a.get(b,"link.subject")};break;case"PhoneLink":f.phone={number:a.get(b,"link.phoneNumber")};break;case"DocumentLink":var h=c.linkRenderer.renderLink(b.link,d,{});f.document={url:a.get(h,"href")};break}return f};var t=function(a){if(a){if(a.type==="PageLink"){return"page"}return"link"}return"menuHeader"};var u=function(a,b){return b.getDataByQuery(a,"masterPage")};var v=function(b,c){var d=[];a.forEach(b,function(b){a.forEach(b.subPages,function(a){d.push(u(a.id,c))});d.push(u(b.id,c))});return d};return{getSitePagesInfoData:f,getSitePagesData:m}});define("tpa/services/pageService",["lodash","tpa/utils/sitePages"],function(a,b){"use strict";var c={};var d=function(d){if(a.size(c)>0){return c}var e=b.getSitePagesData(d.getSiteData());a.forEach(e,function(b){if(b&&b.tpaApplicationId>0){var d={pageId:b.id,tpaId:b.tpaApplicationId,tpaPageId:b.tpaPageId};if(a.isUndefined(c[d.tpaId])){c[d.tpaId]=[]}c[d.tpaId].push(d)}});return c};return{mapPageToWidgets:d}});define("tpa/utils/tpaStyleUtils",["lodash","color","fonts","utils"],function(a,b,c,d){"use strict";var e="param_color_",f="param_number_",g="param_boolean_",h="param_font_";var i=function(){return{Title:"font_0",Menu:"font_1","Page-title":"font_2","Heading-XL":"font_3","Heading-L":"font_4","Heading-M":"font_5","Heading-S":"font_6","Body-L":"font_7","Body-M":"font_8","Body-S":"font_9","Body-XS":"font_10"}};var j=function(){var b=i();return a.invert(b)};var k=function(a,b){var d=c.fontUtils.parseFontStr(a);var e=c.fontUtils.getFontFamilyWithFallbacks(d.family);return{editorKey:b,lineHeight:d.lineHeight,style:d.style,weight:d.weight,size:d.size,fontFamily:d.family.toLowerCase(),value:"font:"+[d.style,d.variant,d.weight,d.size+"/"+d.lineHeight,e].join(" ")+";"}};var l=function(a){var c=a.split(",");return b({r:c[0],g:c[1],b:c[2]}).hexString()};var m=function(b,c,e){var f=a.assign(p(e,c.getAllTheme()),F(b));var g=d.fonts.uploadedFontsUtils;var h=a(f).map(function(b){if(a.isString(b)){b=JSON.parse(b)}return b.family||b.fontFamily}).filter(function(a){return g.isUploadedFontFamily(a)}).union().value();return g.getUploadedFontFaceStyles(h,c.serviceTopology.mediaRootUrl)};var n=function(b,c,d){return o(a.assign(p(d,c.getAllTheme()),F(b)),c)};var o=function(b,d){var e={};a.forEach(b,function(a){if(typeof a==="string"){a=JSON.parse(a)}e[a.family||a.fontFamily]=1});var f=c.fontUtils.getFontsUrl(e,d);if(a.includes(f,"family=null")){return""}return f};var p=function(b,c){var d={};var e=q(b,c);a.forEach(e,function(a,b){if(b.match(h)){d[b.replace(h,"")]=a}});return d};var q=function(a,b){var c=b[a];if(!c){return null}var d=c.style&&c.style.properties;if(!d){return null}return d};var r=function(c,e,f,g){var h=e[c];var i;if(h&&!a.isString(h)&&h.value){return{themeName:undefined,value:h.value.cssColor||h.value.color.value||h.value.rgba}}if(!f&&h&&a.isString(h)&&d.stringUtils.startsWith(h,"color_")){var j=d.colorParser.getColorValue(g,h);j=a.includes(j,",")?l(j):j;var k=b(j);if(e.hasOwnProperty("alpha-"+c)&&e["alpha-"+c]!==1){i="rgba("+k.values.rgb.join(",")+","+e["alpha-"+c]+")"}else{i=k.hexString()}return{themeName:h,value:i}}else if(!f){return{themeName:undefined,value:h}}return{themeName:undefined,value:undefined}};var s=function(b,c,i){var j=a.reduce(c,function(i,j,k){var l;var m=d.stringUtils.startsWith(k,"alpha-");if(m){return i}else if(k.match(e)){l=u(e,k);i[l]=a.get(r(k,c,m,b),"value");return i}else if(k.match(f)){l=u(f,k);i[l]=+j;return i}else if(k.match(g)){l=u(g,k);i[l]=t(j);return i}else if(k.match(h)){l=u(h,k);i[l]=a.get(w(j,b),"value");return i}},{});i(j)};var t=function(b){if(a.isBoolean(b)){return b}return b!=="false"};var u=function(a,b){return"style."+b.replace(a,"")};var v=function(a,b,c,i){var j=i.getAllTheme().THEME_DATA;var k=d.stringUtils.startsWith(a,"alpha-");if(b.hasOwnProperty(a)&&!k){if(a.match(e)){c.colors[a.replace(e,"")]=r(a,b,k,j)}else if(a.match(f)){c.numbers[a.replace(f,"")]=+b[a]}else if(a.match(g)){c.booleans[a.replace(g,"")]=t(b[a])}else if(a.match(h)){c.fonts[a.replace(h,"")]=w(b[a],j)}}};var w=function(a,b){var c=typeof a==="object"?a.value:JSON.parse(a);if(c.fontStyleParam&&c.preset==="Custom"){x(c)}else if(c.fontStyleParam&&c.theme){z(c)}else if(c.fontStyleParam){y(c,b.font)}else if(c.fontParam&&c.preset==="None"){A(c)}else if(c.fontParam){B(c)}return c};var x=function(a){var b=c.fontUtils.getFontFamilyWithFallbacks(a.family);var d=a.size+"px";var e=Math.floor(a.size*1.25)+"px";var f=a.style.italic?"italic":"normal";var g=a.style.bold?"bold":"normal";var h="normal";var i="";i+="font:"+[f,h,g,d+"/"+e,b].join(" ")+";";i+=a.style.underline?"text-decoration:underline;":"";a.value=i};var y=function(a,b){var c=F(b);var d=c[a.preset];a.value=d.value;a.size=parseInt(d.size,10);a.family=d.fontFamily;a.style.bold=d.weight==="bold";a.style.italic=d.style==="italic";a.style.underline=false};var z=function(a){var b=c.fontUtils.getFontFamilyWithFallbacks(a.family);var d=c.fontUtils.parseFontStr(a.preset);a.value="font:"+[d.style,d.variant,d.weight,d.size+"/"+d.lineHeight,b].join(" ")+";";a.size=parseInt(d.size,10);a.family=d.family.toLowerCase();a.style.bold=d.weight==="bold";a.style.italic=d.style==="italic";a.style.underline=false};var A=function(a){var b=c.fontUtils.getFontFamilyWithFallbacks(a.family);var d=a.style.italic?"italic":"normal";var e=a.style.bold?"bold":"normal";var f="";f+="font-family:"+b+";font-style:"+d+";font-weight:"+e+";";f+=a.style.underline?"text-decoration:underline;":"";a.value=f};var B=function(a){a.family=a.value;a.value=C(a);a.size=0;a.style={bold:false,italic:false,underline:false}};var C=function(a){var b="font-family:"+(a.cssFontFamily||a.value)+";";b=b.replace(/''/g,"'");return b};var D=function(b){var d=c.fontUtils.getWixStoredFontsCssUrls(b);if(!b.isViewerMode()){d=a.invokeMap(d,String.prototype.replace,/^https?\:/,"")}return d};var E=function(b,c,d){var e=b.getAllTheme();var f=e.THEME_DATA;var g={colors:{},numbers:{},booleans:{},fonts:{},googleFontsCssUrl:n(f.font,b,c),uploadFontFaces:m(f.font,b,c)};var h=q(c,e);if(!h){return g}a.forEach(h,function(a,c){v(c,h,g,b)});if(d){return a.merge(g,{cssUrls:D(b)})}return g};var F=function(b){var c=0;return a.reduce(i(),function(a,d,e){a[e]=k(b[c++],d);return a},{})};var G=function(b){return a.reduce(b,function(b,c,d){if(d>=1&&d<=5||d>=11&&d<=35){b.push({name:"color_"+d,value:a.includes(c,",")?l(c):c})}return b},[])};var H=function(b){a.forEach(b,function(b){b.fonts=a.reject(b.fonts,{permissions:"legacy"})});return b};var I=function(b,d){var e=b.getSiteData();var f=e.getAllTheme().THEME_DATA;var g=d&&d.hasOrigComponent()?b.getComponentById(d.getOrigComponentId()):d;var h=(a.includes(e.santaBase,"localhost")?e.santaBase:e.santaBase.replace("http://","//"))+"/static/images/editorUI/fonts.v3.png";var i=H(c.fontUtils.getCurrentSelectablefonts(e));var j=D(e);return{fonts:{cssUrls:j,imageSpriteUrl:h,fontsMeta:i},siteTextPresets:F(f.font),siteColors:G(f.color),style:g?E(e,g.props.structure.styleId):{}}};return{getTextPresets:F,getSiteColors:G,getStylesForSDK:E,getStyleDataToPassIntoApp:I,getNameToFontsKeyMap:j,getValueForWixParams:s}});define("tpa/handlers/anchorHandlers",["lodash","utils","coreUtils","tpa/utils/tpaUtils"],function(a,b,c,d){"use strict";var e=function(a){return{id:a.compId,title:a.name}};var f=function(a,b,c){c(g(a))};var g=function(c){var f=c.getSiteData().getCurrentUrlPageId();var g=d.Constants.TOP_PAGE_ANCHOR_PREFIX+f;var h=b.scrollAnchors.getPageAnchors(c.getSiteData(),f,g);return a.map(h,e)};var h=function(a,b,d){var e=b.data.anchorId;if(e===c.siteConstants.PAGE_ANCHORS.TOP_ANCHOR_COMP_ID){a.scrollToAnchor(c.siteConstants.PAGE_ANCHORS.TOP_ANCHOR_ID)}else if(e===c.siteConstants.PAGE_ANCHORS.BOTTOM_ANCHOR_COMP_ID){a.scrollToAnchor(c.siteConstants.PAGE_ANCHORS.BOTTOM_ANCHOR_ID)}else if(i(a,e)){var f=j(a,e);if(f){a.scrollToAnchor(f)}}else if(d){d({error:{message:'anchor with id "'+e+'" was not found on the current page.'}})}};var i=function(b,c){var d=g(b);return a.some(d,{id:c})};function j(a,b){var c=a.getComponentById(b);var d=c.props.compData;return d&&d.id}return{getCurrentPageAnchors:f,navigateToAnchor:h}});define("tpa/handlers/performanceHandlers",["tpa/bi/events"],function(a){"use strict";var b=function(b,c){var d=b.getComponentById(c.compId);if(d&&d.reportPerformanceBiEvent){d.reportPerformanceBiEvent(a.APP_LOADED_SUCCESSFULLY)}};var c=function(b,c){var d=b.getComponentById(c.compId);if(d&&d.reportPerformanceBiEvent){d.reportPerformanceBiEvent(a.APP_LOADED_PARTIALLY,{stage:c.data.stage,stageNum:c.data.stageNum})}};return{applicationLoaded:b,applicationLoadingStep:c}});define("tpa/handlers/tpaHandlers",["zepto","lodash","react","core","utils","animations","tpa/utils/sitePages","tpa/services/pageService","tpa/services/clientSpecMapService","tpa/utils/tpaUtils","tpa/utils/tpaStyleUtils","tpa/bi/errors","reactDOM","tpa/handlers/anchorHandlers","tpa/handlers/performanceHandlers","experiment","wixUrlParser"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){"use strict";var r=e.logger;var s=1e6;var t=d.activityTypes.TPAActivity,u=d.activityService;var v={APP:"APP",COMPONENT:"COMPONENT"};var w=function(a,b,c){var d={};var e=a.getSiteData().getDataByQuery(a.getSiteData().getCurrentUrlPageId());var f=a.getSiteData().getCurrentUrlPageTitle();if(j.sdkVersionIsAtLeast(b.version,"1.42.0")){d.pageTitle=f}else{d.siteTitle=f;d.pageTitle=e.title}d.siteDescription=e.descriptionSEO;d.siteKeywords=e.metaKeywordsSEO;var g=a.getSiteData().currentUrl;d.url=g.full;d.baseUrl=a.getSiteData().getExternalBaseUrl();d.referer=window.document.referrer;c(d)};var x=function(a,c){var d=a.getComponentById(c.compId);if(d){var e=b.get(d,"props.structure.componentType")==="wysiwyg.viewer.components.tpapps.TPAMultiSection";if(e&&b.get(d,"props.pageId")===a.getSiteData().getCurrentUrlPageId()){var f=a.getPageData();var g=b.get(c,"data.title");var h=g||b.get(f,"title","");var i=b.get(c,"data.description")||b.get(f,"descriptionSEO","");var j=b.get(c,"data.overrideTitle")?g:undefined;a.setRunTimePageTitle(b.unescape(h),i,j)}}};var y=function(a,b){var c=typeof b.data==="number"?b.data:b.data.height;if(c>s){var d={height:c};r.reportBI(a.getSiteData(),l.SDK_SET_HEIGHT_ERROR,d)}var e={height:c,ignoreAnchors:b.data.overflow};var f=a.getComponentById(b.compId);f.registerReLayout();f.setState(e)};var z=function(a,b,c){c(a.getSiteData().getCurrentUrlPageId())};var A=function(a,c,d){var e={filterHideFromMenuPages:true,includePagesUrl:b.get(c,"data.includePagesUrl",false),includeIsHomePage:true,enhancedInfo:false};d(g.getSitePagesInfoData(a.getSiteData(),e))};var B=function(a,b,c){var d={filterHideFromMenuPages:true,includePagesUrl:false,includeIsHomePage:false,enhancedInfo:true};c(g.getSitePagesInfoData(a.getSiteData(),d))};var C=function(a,c,d){var e=a.getComponentsByPageId(c);var f=b.find(e,"isTPASection");if(f){f.setState({sectionUrlState:d})}};var D=function(a,c,d,e,f){if(c){var g,h,i=false,j=d.data;if(b.isObject(d.data)){j=d.data.state;h=b.get(d.data.sectionIdentifier,"sectionId");i=b.get(d.data.sectionIdentifier,"noTransition")}if(b.isUndefined(e)||b.isEmpty(e)){G(a,c.appDefinitionName,h);f({error:{message:'Page with app "'+c.appDefinitionName+'" was not found.'}})}else{if(b.isUndefined(h)){g=e[0].pageId}else{var k=b.find(e,{tpaPageId:h});if(b.isUndefined(k)){G(a,c.appDefinitionName,h);f({error:{message:'App page with sectionId "'+h+'" was not found.'}});return}g=k.pageId}C(a,g,j);var l={pageId:g,pageAdditionalData:j};if(i){l.transition="none"}F(a,l,undefined,undefined,true)}}else{G(a);f({error:{message:"Component was not found."}})}};var E=function(a,b,c){var d=a.getComponentById(b.compId);var e,f;if(d){var g=h.mapPageToWidgets(a);e=d.getAppData();f=e&&g[e.applicationId]}D(a,e,b,f,c)};function F(a,b,c,d,e){if(b.pageId===a.getSiteData().getPrimaryPageId()){a.updatePageNavInfo(b,c,d);if(e){a.scrollSiteTo(0,0)}}else{a.navigateToPage(b,c,d)}}var G=function(a,b,c){var d={appDefinitionName:b||"",sectionId:c||""};r.reportBI(a.getSiteData(),l.SDK_NAVIGATION_TO_SECTION_ERROR,d)};var H=function(a,c,d){a.scrollSiteBy(c.data.x,c.data.y);if(b.isFunction(d)){d()}};var I=function(a,c,d){a.scrollSiteTo(c.data.x,c.data.y);if(b.isFunction(d)){d()}};var J=function(a,c,d){var e=b.get(c,"data.pageId");var f=b.get(c,"data.noTransition");var g=b.get(c,"data.anchorId");if(a.getSiteData().getPrimaryPageId()===e){if(g){n.navigateToAnchor(a,c,d)}}else{K(a,e,f,function(){if(g){n.navigateToAnchor(a,c,d)}},d)}};function K(a,c,d,e,f){if(b.includes(a.getSiteData().getAllPageIds(),c)){var g=a.getSiteAspect("actionsAspect");g.registerNavigationComplete(e);var h={pageId:c};if(d){h.transition="none"}a.navigateToPage(h)}else if(f){f({error:{message:'Page id "'+c+'" was not found.'}})}}var L=function(a,c,d){var e=c.data.pageId;var f=c.data.compId;var g=a.getSiteData();var h=g.getFocusedRootId();var i=a.getComponentById(f);if(i&&i.props.structure.componentType==="wysiwyg.viewer.components.tpapps.TPAGluedWidget"){d({error:{message:"Navigation to glued widget not supported."}});return}if(!b.isEmpty(e)&&e!==h){K(a,e,c.data.noPageTransition,M.bind(null,a,i,f,e,d),d)}else{M(a,i,f,e,d)}};var M=function(a,c,d,e,g){e=e||a.getSiteData().getFocusedRootId();c=c||O(a,d,e);if(!c||!N(c)&&c.props.rootId!==e){var h=b.isEmpty(e)?"Current page":'Page id "'+e+'"';g({error:{message:h+' does not contain the component id "'+d+'".'}});return}var i=P(c,a);f.animate("BaseScroll",a.getSiteContainer(),1,0,{y:i.y,x:i.x,callbacks:{onComplete:g}})};var N=function(a){return a.props.rootId==="masterPage"};var O=function(a,b,c){var d=a.getComponentsByPageId(c);return d[b]};var P=function(a,c){var d=c.getSiteData();var f=m.findDOMNode(a);var g=d.measureMap.siteMarginTop||0;var h=e.domMeasurements.getElementRect(f);var i=h.top+g;if(b.get(d,"measureMap.custom.SITE_HEADER.isFixedPosition")){i-=d.measureMap.height.SITE_HEADER}var j=e.scrollAnchors.normalizeYOffset(i,d);var k=h.left;return{x:k,y:j}};var Q=function(c,d,e){var f=c.getSiteData();var g=c.getComponentById(d.compId);var h=m.findDOMNode(g);var i=b.get(f,"measureMap.custom.SITE_HEADER.isFixedPosition");var j=0;if(i){j=f.measureMap.height.SITE_HEADER}var k=b.get(f,"renderFlags.siteScale",1);e({rect:R(h,j),offsets:S(a(h).offset(),j),scale:k})};var R=function(a,c){var d=a.getBoundingClientRect();var e=b(d).pick(["left","right","top","bottom","height","width"]).mapValues(function(a){return Math.floor(a)}).value();if(c){e.top-=c}return e};var S=function(a,b){return{x:a.left,y:a.top-b}};var T=function(a,b,c){var d=a.getComponentById(b.compId);var e=a.getSiteAspect("tpaModalAspect");e.showModal($(b,d),c)};var U=function(a,b,c){var d=a.getComponentById(b.compId);if(!V(d)){var e=new Error;e.name="Operation not supported";e.message="An app can not open a popup from a modal.";throw e}var f=a.getSiteAspect("tpaPopupAspect");f.showPopup($(b,d),c)};var V=function(a){var c=["wysiwyg.viewer.components.tpapps.TPAModal"];return!b.includes(c,a.props.structure.componentType)};var W=function(a,b){var c=a.getComponentById(b.compId);if(c&&c.hide){c.hide(b.data)}};var X=function(a){return b.isString(a)&&/^[0-9]+%$/.test(a)};var Y=function(a){var c=["wysiwyg.viewer.components.tpapps.TPAGluedWidget","wysiwyg.viewer.components.tpapps.TPAPopup","wysiwyg.viewer.components.tpapps.TPAModal"];return a&&a.resizeWindow&&b.includes(c,a.props.structure.componentType)};var Z=function(a,b,c){var d=b.data.width;var e=b.data.height;if(!X(d)){d=parseFloat(d)}if(!X(e)){e=parseFloat(e)}var f=a.getComponentById(b.compId);if(Y(f)){f.resizeWindow(d,e,c)}};var $=function(c,d){var e=b.merge(c.data,{origCompId:c.compId});var f=m.findDOMNode(d);e.origCompStyle=a(f).offset();var g=f.getBoundingClientRect();e.origCompStyle.actualTop=g.top;e.origCompStyle.actualLeft=g.left;e.position=b.defaults(e.position||{},{origin:"FIXED",placement:"CENTER",x:0,y:0});e.position.x=aa(e.position.x);e.position.y=aa(e.position.y);e.windowSize={width:a(window).width(),height:a(window).height()};e.applicationId=d.props.compData.applicationId;e.tpaData=_(d);return e};var _=function(a){return a.props.compData.tpaData};var aa=function(a){if(b.isString(a)){var c=parseInt(a,10);if(!b.isNaN(c)){return c}return 0}else if(b.isNumber(a)){return a}return 0};var ba=function(a,b){var c=b.data.eventKey;var d=a.getComponentById(b.compId);if(d&&d.isCompListensTo&&!d.isCompListensTo(c)){d.startListen(c)}};var ca=function(a,b){var c=b.data.eventKey||b.data;var d=a.getComponentById(b.compId);if(d){d.stopListen(c)}};var da=function(a,b){var c=typeof b.data==="string"?b.data:b.data.state,d=a.getComponentById(b.compId),e;var f=a.getRootOfComponentId(b.compId);var g=a.getSiteData().getExistingRootNavigationInfo(f);var h=g?g.pageId:f;try{e=JSON.parse(c);switch(e.cmd){case"zoom":d.processImageClick(e);break;case"componentReady":d.setComponentInIframeReady();break;case"navigateToDynamicPage":var i=e.args[0];var j=q.getUrl(a.getSiteData(),i);var k=q.parseUrl(a.getSiteData(),j);if(e.args[1]){k.anchorData=e.args[1]}a.handleNavigation(k,e.args[2]);break;case"navigateToAnchor":var l=e.args[0];var m=e.args[1];if(a.getSiteData().getPrimaryPageId()===l){if(m){a.scrollToAnchor(m)}}else{a.navigateToPage({pageId:l,pageAdditionalData:null,anchorData:m})}break;default:ea(a,d,h,c)}}catch(b){ea(a,d,h,c)}};var ea=function(a,b,c,d){if(j.isTPASection(b)){b.setState({pushState:d});F(a,{pageId:c,pageAdditionalData:d,transition:"none"})}};var fa=function(a,b){var c=a.getComponentById(b.compId);var d=b.data.state;var e=a.getRootOfComponentId(b.compId);var f=false;var g=true;if(j.isTPASection(c)){c.setState({pushState:d});F(a,{pageId:e,pageAdditionalData:d,transition:"none"},f,g)}};var ga=function(a,c,d){var e=a.getComponentById(c.compId);if(e){var f=h.mapPageToWidgets(a);var g=a.getSiteData().getClientSpecMap()[e.props.compData.applicationId];var i=g.applicationId;if(b.isEmpty(f)||b.isUndefined(f[i])){d({error:{message:'Page with app "'+g.appDefinitionName+'" was not found.'}})}else{var j=f[i];var k=c.data.sectionIdentifier;var l=b.find(j,{tpaPageId:k})||j[0];var m;if(l){m=l.pageId}if(b.isUndefined(m)){d({error:{message:"Page was not found."}})}else{var n=a.getPageUrlFor(m);if(b.isUndefined(n)){d({error:{message:"Page was not found."}})}else{d({url:n})}}}}else{d({error:{message:"Component was not found."}})}};var ha=function(a,b,c,d){c.getMemberDetails(function(b){if(b!==null){d(b);if(a){a.setSiteMemberDataState(null)}}else if(a){a.setSiteMemberDataState({callback:d})}else{d(null)}})};var ia=function(a,c,d){var e=a.getComponentById(c.compId);var f=a.getSiteAspect("siteMembers");var g=f.isLoggedIn();if(g){ha(e,c,f,function(a){d({authResponse:true,data:a})})}else{var h=b.get(c,"data.mode");var i=h&&h==="login";var k=b.get(c,"data.language","en");var l;if(b.get(c,"data.callOnCancel")){l=function(){d({wasCancelled:true})}}var m=function(a){if(e){e.shouldUpdateState=true}d({authResponse:true,data:a})};f.showAuthenticationDialog({successCallback:m,cancelCallback:l,language:k,showLoginDialog:i,appId:j.getAppDefId(a,c.compId)})}};var ja=function(a,c,d){var e=a.getSiteAspect("siteMembers");var f=e.isLoggedIn();if(f){var g=a.getComponentById(c.compId);if(g){g.shouldUpdateState=true}var h=b.get(c,"data.language");e.logout(h)}else{d({onError:"No member is logged in"})}};var ka=function(a,b,c){var d=a.getComponentById(b.compId);var e=a.getSiteAspect("siteMembers");var f=e.isLoggedIn();if(f){ha(d,b,e,function(a){c(a)})}else{c(null)}};var la=function(a,c){var d=b.get(c,"data.pixelId");var e=b.get(c,"data.pixelType");if(d&&e==="FACEBOOK"){a.initFacebookRemarketing(d)}};var ma=function(a,c){var d=b.get(c,"data",{});var e=b.get(c,"data.eventName");if(e){delete d.eventName;a.fireFacebookRemarketingPixel(e,d)}};var na=function(a,b){var c=b.data,d=a.getComponentById(b.compId),e=a.getSiteData(),f={hubSecurityToken:e.getHubSecurityToken(),svSession:e.getSvSession(),metaSiteId:e.getMetaSiteId(),currentUrl:e.getCurrentUrl()},g=j.getAppData(a,b.compId),h=g.instance,i={type:c.activity.type||"TPA",appDefinitionId:g.appDefinitionId||"TPA",info:c.activity.info||{},details:c.activity.details||{},contactUpdate:c.activity.contactUpdate||{},instance:h},k=function(b){if(b.userSessionToken){a.setUserSession(b.userSessionToken)}m({status:true,response:b})},l=function(a){var b={status:a.status,statusText:a.statusText,responseText:a.responseText};m({status:false,response:b})},m=function(a){d.sendPostMessage({intent:"TPA_RESPONSE",compId:b.compId,callId:b.callId,type:b.type,status:a.status,res:{response:{activityId:a.response.activityId,contactId:a.response.contactId},status:a.status}})};var n=new t(f,i);u.reportActivity(n,k,l)};var oa=function(a,b,c){c(a.getUserSession())};var pa=function(a,c,d){var e=a.getComponentById(c.compId);if(e&&e.setAppIsAlive){e.setAppIsAlive()}if(b.get(e,"hasOrigComponent")){d(k.getStyleDataToPassIntoApp(a,e))}};var qa=function(a,b){return k.getStyleDataToPassIntoApp(a,b)};var ra=function(a,c,d){if(b.isFunction(d)){d(a.getSiteData().getCTToken())}};var sa=function(a,c,d){c.data.messageId=Date.now();var f={ctToken:a.getSiteData().getCTToken()};var g=b.omit(c.data,"version");var h="?"+e.urlUtils.toQueryString(f);var i="//player-counters.wix.com/collector/rest/collect-js"+h;var j=function(a){d({status:"success",response:a})};var k=function(a){var b=a&&a.responseText;d({status:"error",response:b})};e.ajaxLibrary.ajax({type:"OPTIONS",url:i,data:JSON.stringify(g),dataType:"json",contentType:"application/json",success:j,error:k})};var ta=function(a,b,c){var d=a.getComponentById(b.compId);if(d){c(d.props.compData.referenceId)}};var ua=function(){};var va=function(a,b,c){var d=a.getSiteData();var e=d.isViewerMode()?"site":d.renderFlags.componentViewMode;c({editMode:e})};var wa=function(a,c,d){var e=c.data.key;var f=c.data.scope;var g=a.getSiteData();var h=a.getComponentById(c.compId);var i=h.props.compData;var j;if(f===v.APP){j=za(g,e,"tpaData-"+i.applicationId,"masterPage")}else{var k=a.getRootOfComponentId(c.compId);j=za(g,e,i.tpaData,k)}if(b.isEmpty(j)){d({error:{message:"key "+e+" not found in "+f+" scope"}})}else{d(j)}};var xa=function(a,c,d){var e=b.uniq(c.data.keys);var f=a.getSiteData();var g=a.getRootOfComponentId(c.compId);var h=a.getComponentById(c.compId,g);var i=h.props.compData;var j=c.data.scope;var k;if(j===v.APP){var l=Aa(f,"tpaData-"+i.applicationId,"masterPage");k=b.pick(l,e)}else{var m=Aa(f,i.tpaData,g);k=b.pick(m,e)}if(!b.isEmpty(k)&&b(k).keys().isEqual(e)){d(k)}else{var n=b.keys(k);var o=b(n).xor(e).intersection(e).value();d({error:{message:"keys "+o+" not found in "+j+" scope"}})}};var ya=function(a,c,d){var e=a.getComponentById(c.compId);var f=e.props.compData;var g=e.getAppData();var h=N(e);var j=f.widgetId?g.widgets[f.widgetId]:i.getMainSectionWidgetData(g);var k={compId:c.compId,showOnAllPages:h,pageId:h?"":e.props.pageId,tpaWidgetId:b.get(j,"tpaWidgetId",""),appPageId:b.get(j,"appPage.id","")};d(k)};var za=function(a,c,d,e){if(!b.isEmpty(d)){var f=Aa(a,d,e);if(f){return b.pick(f,c)}}return null};var Aa=function(a,b,c){var d=a.getDataByQuery(b,c);if(d&&d.content){return JSON.parse(d.content)}return null};var Ba=function(a,c,d){var f=a.getComponentById(c.compId);if(!f){return d({error:{message:"Component was not found."}})}var g=h.mapPageToWidgets(a);var i=a.getSiteData().getClientSpecMap()[f.props.compData.applicationId];var j=i.applicationId;if(b.isEmpty(g)||b.isUndefined(g[j])){return d({error:{message:'Page with app "'+i.appDefinitionName+'" was not found.'}})}var k=g[j];var l=b.find(k,{tpaPageId:c.data.sectionId});var m;if(l){m={pageId:l.pageId,pageAdditionalData:c.data.state}}else{m={pageId:k[0].pageId}}return d({url:e.wixUrlParser.getUrl(a.getSiteData(),m,undefined,true)})};var Ca=function(a,b,c){var d=a.getComponentById(b.compId);c(d.props.structure.styleId)};var Da=function(a,c,d){var e=a.getSiteData();var f=c.data.styleId;if(b.isUndefined(e.getAllTheme()[f])){d({error:{message:'Style id "'+f+'" was not found.'}})}else{var g=k.getStylesForSDK(e,f,true);d(g)}};var Ea=function(a,c){return{width:b.get(a,"measureMap.custom.WIX_ADS."+c+".width"),height:b.get(a,"measureMap.custom.WIX_ADS."+c+".height"),top:b.get(a,"measureMap.custom.WIX_ADS."+c+".top"),left:b.get(a,"measureMap.custom.WIX_ADS."+c+".left")}};var Fa=function(a,c,d){var e=a.getSiteData();if(e.shouldShowWixAds()){if(e.isMobileView()){d({top:b.merge(Ea(e,"topAd"),{left:0})})}else{d({top:Ea(e,"topAd"),bottom:Ea(e,"bottomAd")})}}else{d({})}};return{siteInfo:w,heightChanged:y,registerEventListener:ba,navigateToPage:J,smRequestLogin:ia,smCurrentMember:ka,scrollBy:H,scrollTo:I,navigateToComponent:L,registerCampaignPixel:la,reportCampaignEvent:ma,postActivity:na,getCurrentPageId:z,getUserSession:oa,boundingRectAndOffsets:Q,navigateToSectionPage:E,getSitePages:A,getSiteMap:B,removeEventListener:ca,appIsAlive:pa,openModal:T,openPopup:U,closeWindow:W,resizeWindow:Z,appStateChanged:da,getSectionUrl:ga,getStyleDataToPassIntoApp:qa,postCountersReport:sa,getExternalId:ta,getViewMode:va,getValue:wa,getValues:xa,getCurrentPageAnchors:n.getCurrentPageAnchors,navigateToAnchor:n.navigateToAnchor,getStateUrl:Ba,getComponentInfo:ya,getStyleId:Ca,getStyleParamsByStyleId:Da,replaceSectionState:fa,logOutCurrentMember:ja,getCtToken:ra,setPageMetadata:x,navigateToSection:D,applicationLoaded:o.applicationLoaded,applicationLoadingStep:o.applicationLoadingStep,getAdsOnPage:Fa,tpaWorker:{siteInfo:w,getSitePages:A,getSiteMap:B,removeEventListener:ca,registerEventListener:ba,registerCampaignPixel:la,reportCampaignEvent:ma,smCurrentMember:ka,appIsAlive:pa,navigateToSectionPage:E,getValue:wa,getValues:xa,applicationLoaded:o.applicationLoaded,applicationLoadingStep:o.applicationLoadingStep,getViewMode:ua,getDeviceType:ua,getLocale:ua,getInstanceId:ua,getIpAndPort:ua},toWixDate:ua,getCompId:ua,getOrigCompId:ua,getWidth:ua,getLocale:ua,getCacheKiller:ua,getTarget:ua,getInstanceId:ua,getSignDate:ua,getUid:ua,getPermissions:ua,getIpAndPort:ua,getDemoMode:ua,getDeviceType:ua,getInstanceValue:ua,getSiteOwnerId:ua,getImageUrl:ua,getResizedImageUrl:ua,getAudioUrl:ua,getDocumentUrl:ua,getSwfUrl:ua,getPreviewSecureMusicUrl:ua,getStyleParams:ua,getStyleColorByKey:ua,getColorByreference:ua,getEditorFonts:ua,getSiteTextPresets:ua,getFontsSpriteUrl:ua,getStyleFontByKey:ua,getStyleFontByReference:ua,getSiteColors:ua,setUILIBParamValue:ua}});define("tpa/handlers/tpaPubSubHandlers",["tpa/utils/tpaUtils","utils","tpa/bi/errors"],function(a,b,c){"use strict";var d=b.logger;return{registerEventListener:function(a,b){a.getSiteAspect("tpaPubSubAspect").subscribe(b)},publish:function(b,e){var f=e.data;var g=e.compId;var h=a.getAppDefId(b,g);if(h){f.eventKey=a.stripPubSubPrefix(f.eventKey);b.getSiteAspect("tpaPubSubAspect").publish(h,g,f)}else{d.reportBI(b.getSiteData(),c.SDK_PUBSUB_PUBLISH_ERROR)}},removeEventListener:function(b,c){var d=c.compId;var e=c.data;var f=a.getAppDefId(b,d);var g=a.stripPubSubPrefix(e.eventKey);b.getSiteAspect("tpaPubSubAspect").unsubscribe(f,d,g)}}});define("tpa/common/tpaBi",["lodash","tpa/utils/tpaUtils","tpa/bi/events","utils"],function(a,b,c,d){"use strict";var e={};var f=function(a){return a?c.JS_SDK_FUNCTION_CALL:c.GALLERY_FUNCTION_CALL};var g=function(a,b){var c=a.widgets;var d=c[b.props.compData.widgetId];var e=d?d.published||d.santaEditorPublished:a.sectionPublished;return e?1:0};var h=function(a,c){var d=b.getClientSpecMap(a);var e=b.getInstance(a,c.appId);if(!d[c.appId]){throw"app definition could not be found by the given appId"}var f=a.getComponentById(c.compId);return{appId:d[c.appId].appDefinitionId,instanceId:e.instanceId,isPublished:g(d[c.appId],f)}};var i=function(b,c){c.component=b.getComponentById(c.compId);c.appId=a.get(c,"component.props.compData.applicationId");return c};var j=function(a){return a.component&&a.component.props.compData&&a.version&&a.type&&a.namespace};var k=function(c,g,k){var l={count:1,target:1};if(a.has(e,c.type)){l=a.get(e,c.type);++l.count}else{e[c.type]=l}if(l.count===l.target){var m=i(g,c);if(!j(m)){return}var n={visitorUuid:b.getVisitorUuid(d),sdkVersion:m.version,origin:k,fnName:m.type,namespace:m.namespace,count:l.count};if(m.appId){var o=h(g,m);a.merge(n,o)}var p=f(m.appId);g.reportBI(p,n);l.target*=10}};return{sendBIEvent:k}});define("tpa/aspects/TPAPostMessageAspect",["lodash","experiment","tpa/common/tpaPostMessageCommon","tpa/handlers/tpaHandlers","tpa/handlers/tpaPubSubHandlers","tpa/utils/tpaUtils","tpa/common/tpaBi","tpa/services/clientSpecMapService","utils"],function(a,b,c,d,e,f,g,h,i){"use strict";var j={getCtToken:true};var k=function(b){if(a.has(b,"data")&&!a.isNull(b.data)){return b.data.eventKey&&i.stringUtils.startsWith(b.data.eventKey,f.Constants.TPA_PUB_SUB_PREFIX)}};var l=function(a){if(k(a)){return e}else if(n(a.compId)){return d.tpaWorker}return d};var m=function(a,d,e){if(o(a,d.compId,d.type)){var f=c.fixOldPingPongMessageType(d.type);var h=l(d);if(h[f]){h[f].apply(this,[a,d,e]);if(b.isOpen("sv_SendSdkMethodBI")){g.sendBIEvent(d,a,d.origin||"viewer")}}}};var n=function(a){return a&&i.stringUtils.startsWith(a,"tpaWorker_")};var o=function(b,c,d){var e=c&&b.getComponentById(c);return(d!=="appStateChanged"||e&&a.includes(b.getAllRenderedRootIds(),e.props.rootId))&&p(b,c,d)};var p=function(a,b,c){return!j[c]||h.isSuperAppByCompId(a,b)};var q=function(a){a.registerToMessage(this.handleTPAMessage.bind(this));this._siteAPI=a};q.prototype={handleTPAMessage:function(a){c.handleTPAMessage.call(this,undefined,this._siteAPI,m,a)},sendPostMessage:function(a,b){var d=a.getIframe();if(d){c.callPostMessage(d,b)}else{throw new Error("No iframe found in TPA component",a)}},callHandler:m};return q});define("tpa/mixins/tpaRuntimeCompMixin",["santaProps"],function(a){"use strict";return{propTypes:{compData:a.Types.Component.compData.isRequired},getOrigComponentId:function(){return this.props.compData.origCompId}}});define("tpa/components/tpaPopup",["lodash","react","core","utils","compUtils","santaProps","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaRuntimeCompMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=c.compRegistrar;var l=c.compMixins;var m={FIXED:"FIXED",ABSOLUTE:"ABSOLUTE",RELATIVE:"RELATIVE",DEFAULT:"DEFAULT"};var n={bottomCenter:"BOTTOM_CENTER",bottomLeft:"BOTTOM_LEFT",bottomRight:"BOTTOM_RIGHT",center:"CENTER",centerLeft:"CENTER_LEFT",centerRight:"CENTER_RIGHT",topCenter:"TOP_CENTER",topLeft:"TOP_LEFT",topRight:"TOP_RIGHT"};var o=function(a,b,c){return a+b/2-c/2};var p=function(a,b,c){return a-(b+c)};var q=function(a,b,c){return a-(b+c)};var r=function(a,b,c){return a+b/2-c/2};var s=function(b){function c(a){return/(%)$/.exec(a)}function d(a){return/^([0-9]+)/.exec(a)}var e=0,f="";if(a.isNumber(b)){e=b}else if(a.isString(b)){var g=c(b);var h=d(b);e=h&&h[1]?parseInt(h[1],10):0;if(g&&g[1]){f=g[1]}}return{size:e,unit:f}};var t=function(b,c,d,e){var f={position:"fixed",display:"block",width:d,height:e};e=s(e);e.size=e.unit==="%"?a.min([e.size,100]):a.min([e.size,c.height]);d=s(d);d.size=d.unit==="%"?a.min([d.size,100]):a.min([d.size,c.width]);if(b.placement===n.center){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,marginTop:e.unit==="%"?0:e.size/-2+e.unit,left:"50%",top:e.unit==="%"?0:"50%"})}else if(b.placement===n.topLeft){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,left:"0px",top:"0px"})}else if(b.placement===n.topRight){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,right:"0px",top:"0px"})}else if(b.placement===n.topCenter){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,top:"0px",left:"50%"})}else if(b.placement===n.centerRight){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginTop:e.unit==="%"?0:e.size/-2+e.unit,top:e.unit==="%"?0:"50%",right:"0px"})}else if(b.placement===n.centerLeft){
return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginTop:e.unit==="%"?0:e.size/-2+e.unit,top:e.unit==="%"?0:"50%",left:"0px"})}else if(b.placement===n.bottomLeft){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,bottom:"0px",left:"0px"})}else if(b.placement===n.bottomRight){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,bottom:"0px",right:"0px"})}else if(b.placement===n.bottomCenter){return a.assign(f,{height:e.size+e.unit,width:d.size+d.unit,marginLeft:d.size/-2+d.unit,left:"50%",bottom:"0px"})}return f};var u=function(b,c,d,e,f){var g={position:"absolute",display:"block"};var h,i;if(b.placement===n.center){e=a.min([e,d.height]);f=a.min([f,d.width]);h=r(c.top,c.height,e);i=o(c.left,c.width,f)}else if(b.placement===n.topLeft){e=a.min([e,c.top]);f=a.min([f,c.left]);h=c.top-e;i=c.left-f}else if(b.placement===n.topRight){e=a.min([e,c.top]);f=a.min([f,q(d.width,c.width,c.left)]);h=c.top-e;i=c.width+c.left}else if(b.placement===n.topCenter){e=a.min([e,c.top]);f=a.min([f,d.width]);h=c.top-e;i=o(c.left,c.width,f)}else if(b.placement===n.centerRight){e=a.min([e,d.height]);f=a.min([f,q(d.width,c.width,c.left)]);h=r(c.top,c.height,e);i=c.width+c.left}else if(b.placement===n.centerLeft){e=a.min([e,d.height]);f=a.min([f,c.left]);h=r(c.top,c.height,e);i=c.left-f}else if(b.placement===n.bottomLeft){e=a.min([e,p(d.height,c.top,c.height)]);f=a.min([f,c.left]);h=c.top+c.height;i=c.left-f}else if(b.placement===n.bottomRight){e=a.min([e,p(d.height,c.top,c.height)]);f=a.min([f,q(d.width,c.width,c.left)]);h=c.top+c.height;i=c.width+c.left}else if(b.placement===n.bottomCenter){e=a.min([e,p(d.height,c.top,c.height)]);f=a.min([f,d.width]);h=c.top+c.height;i=o(c.left,c.width,f)}h=a.max([0,h]);i=a.max([0,i]);return a.assign(g,{top:h,left:i,width:f,height:e})};var v=function(b,c,d,e,f){var g={position:"absolute",display:"block"};var h,i,j,k;if(b.placement===n.center){j=a.min([c.actualTop+b.y,d.height-(c.actualTop+b.y)]);e=a.min([e,2*j]);k=a.min([c.actualLeft+b.x,d.width-(c.actualLeft+b.x)]);f=a.min([f,2*k]);h=c.top+b.y-e/2;i=c.left+b.x-f/2}else if(b.placement===n.topLeft){e=a.min([e,c.actualTop+b.y]);f=a.min([f,c.actualLeft+b.x]);h=c.top+b.y-e;i=c.left+b.x-f}else if(b.placement===n.topRight){e=a.min([e,c.actualTop+b.y]);f=a.min([f,d.width-(c.actualLeft+b.x)]);h=c.top+b.y-e;i=c.left+b.x}else if(b.placement===n.topCenter){e=a.min([e,c.actualTop+b.y]);k=a.min([c.actualLeft+b.x,d.width-(c.actualLeft+b.x)]);f=a.min([f,2*k]);h=c.top+b.y-e;i=c.left+b.x-f/2}else if(b.placement===n.centerRight){j=a.min([c.actualTop+b.y,d.height-(c.actualTop+b.y)]);e=a.min([e,2*j]);f=a.min([f,d.width-(c.actualLeft+b.x)]);h=c.top+b.y-e/2;i=c.left+b.x}else if(b.placement===n.centerLeft){j=a.min([c.actualTop+b.y,d.height-(c.actualTop+b.y)]);e=a.min([e,2*j]);f=a.min([f,c.actualLeft+b.x]);h=c.top+b.y-e/2;i=c.left+b.x-f}else if(b.placement===n.bottomLeft){e=a.min([e,d.height-(c.actulaTop+b.y)]);f=a.min([f,c.actualLeft+b.x]);h=c.top+b.y;i=c.left+b.x-f}else if(b.placement===n.bottomRight){e=a.min([e,d.height-(c.actualTop+b.y)]);f=a.min([f,d.width-(c.actualLeft+b.x)]);h=c.top+b.y;i=c.left+b.x}else if(b.placement===n.bottomCenter){e=a.min([e,d.height-(c.actualTop+b.y)]);k=a.min([c.actualLeft+b.x,d.width-(c.actualLeft+b.x)]);f=a.min([f,2*k]);h=c.top+b.y;i=c.left+b.x-f/2}h=a.max([0,h]);i=a.max([0,i]);return a.assign(g,{top:h,left:i,width:f,height:e})};var w=function(b,c,d,e){var f=10;if(e.width<f||e.height<f){var g=s(d);g.size=g.unit==="%"?a.min([g.size,100]):a.min([g.size,b.height]);var h=s(c);h.size=h.unit==="%"?a.min([h.size,100]):a.min([h.size,b.width]);return{position:"fixed",display:"block",width:h.size+g.unit,height:g.size+h.unit,marginLeft:h.size/-2+g.unit,marginTop:g.size/-2+h.unit,left:"50%",top:"50%"}}return e};var x=function(a,b,c,d,e){var f={};if(a.origin===m.DEFAULT||a.origin===m.FIXED){f=t(a,c,d,e)}if(a.origin===m.RELATIVE){f=u(a,b,c,e,d)}if(a.origin===m.ABSOLUTE){f=v(a,b,c,e,d)}f=w(c,d,e,f);return f};var y=function(a){var b=a.getReactComponents();var c=b&&b.length>0;return c?1001:null};var z={displayName:"TPAPopup",mixins:[l.skinBasedComp,g,h,i,j],propTypes:{compData:f.Types.Component.compData.isRequired,id:f.Types.Component.id.isRequired,onCloseCallback:b.PropTypes.func,tpaPopupAspect:f.Types.SiteAspects.tpaPopupAspect.isRequired,tpaModalAspect:f.Types.SiteAspects.tpaModalAspect.isRequired},statics:{useSantaTypes:true},getInitialState:function(){return{showComponent:true,registeredEvents:[],$displayDevice:this.getDeviceType()}},getSkinProperties:function(){var a=this.state.showComponent?this.getSelfStyle():{display:"none"};var b=this.isBareTheme()?"none":"block";if(this.state.showComponent){return{"":{style:a},closeButton:{onClick:this.hide,style:{display:b}},iframe:{src:this.buildUrl(this.props.compData.url),scrolling:"no",frameBorder:"0",allowTransparency:true,allowFullScreen:true,name:this.props.id}}}return{"":{style:a}}},mutateIframeUrlQueryParam:function(a){a.origCompId=this.props.compData.origCompId;return a},getSelfStyle:function(){var b=a.defaults(this.props.compData.position,{x:0,y:0});var c=this.props.compData.origCompStyle;var d=this.props.compData.windowSize;var e=a.isUndefined(this.state.width)?this.props.compData.width:this.state.width;var f=a.isUndefined(this.state.height)?this.props.compData.height:this.state.height;var g=x(b,c,d,e,f);g.zIndex=y(this.props.tpaModalAspect);return this.getThemeStyle(g)},getThemeStyle:function(b){if(this.isBareTheme()){return a.merge(b,{background:"none",boxShadow:"none",borderRadius:0})}return b},hide:function(b,c){var d=this;e.compFactory.invalidate("wysiwyg.viewer.components.tpapps.TPAPopup");this.setState({showComponent:false},function(){var e=b&&b.message?b:undefined;if(d.props.onCloseCallback){d.props.onCloseCallback(e)}this.props.tpaPopupAspect.removePopup(d);if(a.isFunction(c)){c()}})},isBareTheme:function(){return this.props.compData.theme==="BARE"}};k.register("wysiwyg.viewer.components.tpapps.TPAPopup",z);return z});define("tpa/aspects/TPAPopupAspect",["lodash","santaProps","utils","compUtils","tpa/components/tpaPopup"],function(a,b,c,d){"use strict";function e(){return{componentType:"wysiwyg.viewer.components.tpapps.TPAPopup",type:"Component",id:c.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAPopupSkin",styleId:""}}function f(a,c,e,f,g){var h=b.componentPropsBuilder.getCompProps(a,c,null,e);h.compData=f;h.onCloseCallback=g;return d.compFactory.getCompClass(a.componentType)(h)}function g(a){this.aspectSiteApi=a;this.shouldShowPopup=false;this.tpaPopup=[];this.aspectSiteApi.registerToUrlPageChange(this.removeAllPopups.bind(this))}g.prototype={getComponentStructures:function(){if(this.shouldShowPopup){return[e()]}return null},getReactComponents:function(a){var b;if(this.shouldShowPopup){if(this.shouldShowNewPopup){this.shouldShowNewPopup=false;var c=e();b=f(c,this.aspectSiteApi.getSiteAPI(),a,this.popupData,this.popupOnClose);this.tpaPopup.push(b)}return this.tpaPopup}return null},showPopup:function(a,b){this.shouldShowPopup=true;this.shouldShowNewPopup=true;this.popupData=a;this.popupOnClose=b;this.aspectSiteApi.forceUpdate()},removePopup:function(b){var c=b.props.id;var d=this.tpaPopup;this.tpaPopup=a.reject(d,{props:{id:c}});this.aspectSiteApi.forceUpdate()},removeAllPopups:function(){if(!a.isEmpty(this.tpaPopup)){this.tpaPopup=[];this.shouldShowPopup=false;this.aspectSiteApi.forceUpdate()}}};return g});define("tpa/classes/PubSubHub",["lodash","utils"],function(a,b){"use strict";var c=1e3;var d=function(a){this.hub=a||{}};d.prototype={persistData:function(a,d,e,f){var g={data:f,name:d,origin:e};var h=this._addEvent(a,d);if(h.data.length>=c){b.log.warn("You have exceeded the data limit, and some of the data will be lost! Please make sure you are not persisting unneeded data.");h.data.shift()}h.data.push(g)},addEventListener:function(b,c,d){var e=this._addEvent(b,c);if(!a.includes(e.listeners,d)){e.listeners.push(d)}},removeEventListener:function(b,c,d){var e=this._getEvent(b,c);if(e){e.listeners=a.without(e.listeners,d)}},getPersistedData:function(a,b){var c=this._getEvent(a,b);return c&&c.data},getEventListeners:function(a,b){var c=this._getEvent(a,b);return c&&c.listeners},deleteCompListeners:function(b,c){var d=this;var e=this._getAppEvents(b);a.forOwn(e,function(a,e){d.removeEventListener(b,e,c)})},_addEvent:function(a,b){var c=this.hub[a];if(!c){c=this.hub[a]={}}var d=c[b];if(!d){d=c[b]={data:[],listeners:[]}}return d},_getEvent:function(a,b){var c=this.hub[a];if(c){return c[b]}},_getAppEvents:function(a){return this.hub[a]}};return d});define("tpa/aspects/TPAPubSubAspect",["lodash","tpa/utils/tpaUtils","tpa/classes/PubSubHub"],function(a,b,c){"use strict";var d=function(a){this.aspectSiteAPI=a;this.hub=new c};d.prototype={publish:function(c,d,e){var f=e.eventKey;var g=e.isPersistent;var h=this.hub.getEventListeners(c,f);var i={eventType:b.addPubSubEventPrefix(f),intent:"addEventListener",params:{data:e.eventData,name:f,origin:d}};a.forEach(h,function(a){this._sendDataToComp(a,i)}.bind(this));if(g){var j=e.eventData;this.hub.persistData(c,f,d,j)}},subscribe:function(c){var d=c.compId;var e=c.data;var f=b.stripPubSubPrefix(e.eventKey);var g=e.receivePastEvents;var h=b.getAppDefId(this.aspectSiteAPI,d);this.hub.addEventListener(h,f,d);if(g){var i=this.hub.getPersistedData(h,f);if(!a.isEmpty(i)){var j={intent:"TPA_RESPONSE",compId:d,callId:c.callId,type:c.type,status:true,res:{drain:true,data:i}};this._sendDataToComp(d,j)}}},unsubscribe:function(a,b,c){var d=this.hub.getEventListeners(a,c);if(d){this.hub.removeEventListener(a,c,b)}},deleteCompListeners:function(a,b){this.hub.deleteCompListeners(a,b)},_sendDataToComp:function(a,b){var c=this.aspectSiteAPI.getComponentById(a);if(c){c.sendPostMessage(b)}}};return d});define("tpa/aspects/TPAPixelTrackerAspect",["lodash","utils","tpa/common/TPABaseUrlBuilder"],function(a,b,c){"use strict";var d=b.urlUtils;var e=b.throttleUtils.throttledForEach;var f;var g=function(b){return a.filter(b,function(b){return a.isString(b.pixelUrl)&&b.permissions&&!b.permissions.revoked})};var h=function(a){new window.Image(0,0).src=a};var i=function(){var b=f.getPageUrl.bind(f);var h=g(f.getSiteData().getClientSpecMap());var i=a.map(h,function(a){return new c(a.pixelUrl).addMultipleQueryParams({instance:a.instance,page:b(),ck:d.cacheKiller()}).build()});e(i,j.sendRequest,j.CHUNK_SIZE,j.CHUNK_INTERVAL)};function j(a){f=a;f.registerToComponentDidMount(i);f.registerToUrlPageChange(i)}j.prototype={getReactComponents:function(){return null}};j.sendRequest=h;j.CHUNK_SIZE=1;j.CHUNK_INTERVAL=100;return j});define("tpa/aspects/TPAPageNavigationAspect",["lodash"],function(a){"use strict";var b=function(a,b,c,d){return a.type==="PAGE_NAVIGATION"||a.type==="PAGE_NAVIGATION_IN"&&d===b||a.type==="PAGE_NAVIGATION_OUT"&&d===c};var c=function(a,b){this._listeners={};this._siteAPI=a;this._currentPageId=b||this._siteAPI.getSiteData().getCurrentUrlPageId();this._siteAPI.registerToUrlPageChange(this.notifyPageChanged.bind(this))};c.prototype={notifyPageChanged:function(){var c=this._siteAPI.getSiteData().getCurrentUrlPageId(),d=this._currentPageId;a.forEach(this._listeners,function(e){a.forEach(e,function(a){var e=a.comp.props.rootId;var f=a.comp.isMounted();if(f&&b(a,c,d,e)){a.comp.sendPostMessage({intent:"addEventListener",eventType:a.type,params:{toPage:c,fromPage:d,isAppOnPage:e===c,wasAppOnPage:e===d}})}})});this._currentPageId=c},registerToPageChanged:function(a,b){var c=this._listeners[a.props.id];if(!c){c=this._listeners[a.props.id]=[]}c.push({comp:a,type:b})},unregisterToPageChanged:function(a){delete this._listeners[a.props.id]}};return c});define("tpa/components/tpaModal",["lodash","zepto","react","compUtils","core","santaProps","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/mixins/tpaRuntimeCompMixin","tpa/mixins/tpaResizeWindowMixin"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=e.compRegistrar;var l=e.compMixins;var m=50;var n={displayName:"TPAModal",propTypes:{compData:f.Types.Component.compData.isRequired,windowResizeEvent:f.Types.SiteAspects.windowResizeEvent.isRequired,id:f.Types.Component.id.isRequired,isMobileView:f.Types.isMobileView.isRequired,tpaModalAspect:f.Types.SiteAspects.tpaModalAspect.isRequired,exitFullScreenMode:f.Types.exitFullScreenMode.isRequired,onCloseCallback:c.PropTypes.func},statics:{useSantaTypes:true},mixins:[l.skinBasedComp,g,h,i,j,l.blockOuterScrollMixin],getInitialState:function(){this.props.windowResizeEvent.registerToResize(this);return{showComponent:true,registeredEvents:[],$displayDevice:this.getDeviceType(),windowSize:this.props.compData.windowSize}},getDefaultProperties:function(){return{"":{style:{position:"fixed",display:"block"},onWheel:this.blockOuterScroll},blockingLayer:{onClick:this.hide},frameWrap:{style:this.getIframeWrapperStyle()},dialog:{style:this.getDialogStyle()},xButton:{children:"",onClick:this.hide,style:{display:"block"}},iframe:{src:this.buildUrl(this.props.compData.url),frameBorder:"0",allowTransparency:true,allowFullScreen:true,name:this.props.id}}},getHiddenProperties:function(){return{"":{style:{display:"none"}}}},getBareProperties:function(){return a.merge(this.getDefaultProperties(),{frameWrap:{style:{background:"transparent",border:"none"}},xButton:{style:{display:"none"}}})},getSkinProperties:function(){if(this.state.showComponent){switch(this.props.compData.theme){case"BARE":case"LIGHT_BOX":return this.getBareProperties();default:return this.getDefaultProperties()}}return this.getHiddenProperties()},getIframeWrapperStyle:function(){var a=this.props.isMobileView;var b={};if(a){b={WebkitOverflowScrolling:"touch",overflowY:"scroll"}}return b},getDialogStyle:function(){if(this.getDeviceType()==="mobile"){return{}}var b=this.state.windowSize;var c=a.isNumber(this.state.width)?this.state.width:this.props.compData.width;var d=a.isNumber(this.state.height)?this.state.height:this.props.compData.height;c=Math.min(c,b.width);d=Math.min(d,b.height);var e=this.getAppData();if(!e.isWixTPA){var f=b.width-m;var g=b.height-m;if(c>=f&&d>=g){c=f;d=g}}return{width:c,height:d,marginTop:-d/2,marginLeft:-c/2}},mutateIframeUrlQueryParam:function(a){a.origCompId=this.props.compData.origCompId;return a},hide:function(b,c){d.compFactory.invalidate("wysiwyg.viewer.components.tpapps.TPAModal");var e=this;this.setState({showComponent:false},function(){var d=b&&b.message?b:undefined;if(e.props.onCloseCallback){e.props.onCloseCallback(d)}if(e.state.$displayDevice==="mobile"){e.props.exitFullScreenMode()}e.props.windowResizeEvent.unregisterToResize(e);e.props.tpaModalAspect.removeModal(e);if(a.isFunction(c)){c()}})},isBareTheme:function(){return this.props.compData.theme==="BARE"},onResize:function(){var a=b(window);this.setState({windowSize:{width:a.width(),height:a.height()}})}};k.register("wysiwyg.viewer.components.tpapps.TPAModal",n);return n});define("tpa/aspects/TPAModalAspect",["lodash","compUtils","santaProps","utils","tpa/components/tpaModal"],function(a,b,c,d,e){"use strict";function f(){return{componentType:"wysiwyg.viewer.components.tpapps.TPAModal",type:"Component",id:d.guidUtils.getUniqueId(),skin:"wysiwyg.viewer.skins.TPAModalSkin"}}function g(a,d,e,f,g){var h=c.componentPropsBuilder.getCompProps(a,d,null,e);h.compData=f;h.onCloseCallback=g;h.key=a.id;return b.compFactory.getCompClass(a.componentType)(h)}function h(a){this.aspectSiteApi=a;this.modalStructure=null}h.prototype={getComponentStructures:function(){if(this.modalStructure){return[this.modalStructure]}return null},getReactComponents:function(a){if(this.modalStructure){return[g(this.modalStructure,this.aspectSiteApi.getSiteAPI(),a,this.modalData,this.modalOnClose)]}return null},showModal:function(a,b){if(this.aspectSiteApi.getSiteData().isMobileView()){if(a.theme==="LIGHT_BOX"){this.aspectSiteApi.exitFullScreenMode();this.aspectSiteApi.setSiteRootHiddenState(true)}else{this.aspectSiteApi.enterFullScreenMode();this.aspectSiteApi.setSiteRootHiddenState(false)}}this.modalStructure=f();this.modalData=a;this.modalOnClose=b;this.aspectSiteApi.forceUpdate()},removeModal:function(){if(this.aspectSiteApi.getSiteData().isMobileView()){this.aspectSiteApi.exitFullScreenMode();this.aspectSiteApi.setSiteRootHiddenState(false)}this.modalStructure=null;this.aspectSiteApi.forceUpdate()}};return h});define("tpa/aspects/tpaAspectCollector",["core","tpa/aspects/TPAWorkerAspect","tpa/aspects/TPAPostMessageAspect","tpa/aspects/TPAPopupAspect","tpa/aspects/TPAPubSubAspect","tpa/aspects/TPAPixelTrackerAspect","tpa/aspects/TPAPageNavigationAspect","tpa/aspects/TPAModalAspect"],function(a){"use strict";var b=a.siteAspectsRegistry;b.registerSiteAspect("tpaWorkerAspect",arguments[1]);b.registerSiteAspect("tpaPostMessageAspect",arguments[2]);b.registerSiteAspect("tpaPopupAspect",arguments[3]);b.registerSiteAspect("tpaPubSubAspect",arguments[4]);b.registerSiteAspect("tpaPixelTrackerAspect",arguments[5]);b.registerSiteAspect("tpaPageNavigationAspect",arguments[6]);b.registerSiteAspect("tpaModalAspect",arguments[7])});define("tpa/layout/gluedWidgetPatcher",["lodash"],function(a){"use strict";var b="fixed";function c(c,d,e){var f={};a.forEach(e,function(e){var g=d[e]&&d[e][c];var h=e;if(a.isUndefined(g)){return}if(e.indexOf(b)===0){h=h.slice(b.length).toLowerCase()}f[h]=g});return f}function d(b,c,d){return{top:a.isNumber(b.top)?a.parseInt(b.top):d-b.height,bottom:a.isNumber(b.bottom)?d-a.parseInt(b.bottom):a.parseInt(b.top)+b.height,right:a.isNumber(b.right)?c-a.parseInt(b.right):a.parseInt(b.left)+b.width,left:a.isNumber(b.left)?a.parseInt(b.left):c-b.width}}function e(a,b){return!(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom)}function f(b,c,d){if(e(d,c)&&a.isNumber(b.top)){b.top=(b.top||0)+(d.bottom-c.top)}return b}function g(a,b,c){var e=a;var g=b.height.screen;var h=b.width.screen;var i=b.custom&&b.custom[c.WIX_ADS_ID]&&b.custom[c.WIX_ADS_ID].topAd;if(i){var j=d(e,h,g);e=f(e,j,i)}return e}function h(b,d,e,f,h){var i=["position","fixedTop","fixedLeft","right","bottom","width","height"];var j=c(b,e,i);j=g(j,e,h);j=a.omit(j,["width","height"]);d.css(b,j)}function i(){this.patchGluedWidget=h}return i});define("tpa/layout/tpaMeasurer",["zepto"],function(a){"use strict";return{measureTPA:function(b,c,d,e,f){var g=a(d[b]);c.custom[b]={hasIframe:Boolean(d[b+"iframe"])};var h=parseInt(g.css("min-height"),10);var i=parseInt(g.css("min-width"),10);var j=g.attr("data-ignore-anchors");if(h&&j!=="true"){c.minHeight[b]=h;c.height[b]=h}if(h&&j==="true"){c.minHeight[b]=f.structure.layout.height;c.height[b]=f.structure.layout.height}if(i){c.minWidth[b]=i;c.width[b]=i}}}});define("tpa/layout/tpaGluedWidgetPlacement",[],function(){"use strict";function a(a,b){var c=a.applicationId;var d=a.widgetId;var e=b[c];if(e){var f=e.widgets[d];if(f){var g=f.gluedOptions||{horizontalMargin:0,placement:"BOTTOM_RIGHT",verticalMargin:0};return g.placement}}}return{getDefaultPlacement:a}});define("tpa/utils/gluedWidgetMeasuringUtils",["lodash","tpa/layout/tpaGluedWidgetPlacement"],function(a,b){"use strict";var c=300,d=120;function e(a){if(typeof a==="number"){return a}if(!a){return 0}return parseFloat(a)||0}function f(b,f,g,h,i,j,k){j=e(j);k=e(k);var l={};var m;function n(){if(j>=-1&&j<=1){var a=h/2-f/2;var b=h-d*2;var c=b/2-f/2;var e=j*c;l.top=a+e}else if(j<-1&&j>=-2){m=2+j;l.top=m*d}else if(j>1&&j<=2){m=2-j;var g=Math.floor(m*d);l.top=h-g-f}}function o(){if(k>=-1&&k<=1){var a=g/2-b/2;var d=g-c*2;var e=d/2-b/2;var f=k*e;l.left=a+f}else if(k>1&&k<=2){m=2-k;var h=Math.floor(m*c);l.left=g-h-b}else if(k<-1&&k>=-2){m=2+k;l.left=m*c}}switch(i){case"TOP_LEFT":l.top=0;l.left=0;l.bottom="auto";break;case"TOP_RIGHT":l.top=0;l.right=0;l.bottom="auto";break;case"TOP_CENTER":l.top=0;l.bottom="auto";o();break;case"CENTER_RIGHT":l.right=0;n();break;case"CENTER_LEFT":l.left=0;n();break;case"BOTTOM_LEFT":l.bottom=0;l.left=0;l.top="auto";break;case"BOTTOM_CENTER":l.bottom=0;l.top="auto";o();break;case"BOTTOM_RIGHT":default:l.bottom=0;l.right=0;l.top="auto";break}return a.defaults(l,{position:"fixed",top:"",left:""})}function g(b,c){var d={};if(c&&c>0){if(a.isNumber(b.bottom)&&b.bottom<c){d.bottom=c}}return d}function h(a){if(a>2||a<-2){a=0}return a}function i(c,d,e,i,j){var k=h(d.props.horizontalMargin);var l=h(d.props.verticalMargin);var m=d.props.placement||b.getDefaultPlacement(d.data,c);var n=f(d.layout.width,d.layout.height,e,i,m,l,k);var o=g(n,j||0);var p=a.assign(n,o);if(p.right===0){p.left=e-d.layout.width}if(p.bottom===0){p.top=i-d.layout.height-(j||0)}return p}return{getGluedWidgetMeasurements:i}});define("tpa/layout/gluedWidgetMeasurer",["lodash","zepto","tpa/layout/tpaMeasurer","tpa/utils/gluedWidgetMeasuringUtils"],function(a,b,c,d){"use strict";function e(a,b,c,d){var e=d.isMobileView()?"mobileAd":"desktopWADTop";var f=c[a].querySelector("#"+a+e);var g=c[a].querySelector("#"+a+"desktopWADBottom");if(f||g){if(!b.custom[a]){b.custom[a]={}}if(f){b.custom[a].topAd=f.getBoundingClientRect()}if(g){b.custom[a].bottomAd=g.getBoundingClientRect()}}}function f(a){if(a.right===0){a.left="auto"}if(a.bottom===0){a.top="auto"}if(a.left===0){a.right="auto"}if(a.top===0){a.bottom="auto"}return a}function g(e,g,h,i,j,k){var l=k.propertiesItem;var m=k.dataItem;var n=a.assign(k.layout,{height:b(i[g]).height(),width:b(i[g]).width()});var o=h.width.screen;var p=h.height.screen;l.placement=l.placement||e(m,j);var q={props:l,data:m,layout:n};var r=j.rendererModel.clientSpecMap;var s=d.getGluedWidgetMeasurements(r,q,o,p,h.siteMarginBottom);s=f(s);s.fixedTop=s.top;s.fixedLeft=s.left;delete s.top;delete s.left;a.forEach(s,function(a,b){h[b]=h[b]||{};h[b][g]=a});h.width[g]=n.width;c.measureTPA(g,h,i)}function h(a){function b(b,c){try{return a.getDefaultPlacement(b,c)}catch(a){return""}}this.measureWixAdComponent=e;this.measureGluedWidget=g.bind(this,b)}return h});define("tpa/layout/tpaSectionPatcher",["lodash","zepto","tpa/services/clientSpecMapService"],function(a,b,c){"use strict";function d(a,b,c){var d=b.height.screen-b.siteOffsetTop;a.height=d+"px";a.minHeight=d+"px";a.top=b.siteOffsetTop+"px";if(!c.isViewerMode()){a.left=undefined;a.right=undefined}return a}function e(b,d){var e=a.get(b,"widgetId");var f=e?a.get(d.widgets,e):c.getMainSectionWidgetData(d);return a.get(f,"appPage.fullPage",false)}return{patchTPASection:function(a,b,c,f,g){var h=f.dataItem;var i=g.rendererModel.clientSpecMap;var j=i[h.applicationId];var k=c.height[a];if(j&&e(h,j)){var l={};l.position="fixed";l.left="0px";l.top="0px";l.right="0px";l.bottom="0px";if(g.isMobileView()){k=c.height.screen-c.siteOffsetTop;l=d(l,c,g)}b.css(a,l)}var m=c.width[a];var n=g.os.ios&&g.browser.safari;if(n&&c.custom[a].hasIframe){b.css(a+"iframe",{width:m,height:k})}}}});define("tpa/layout/mobileSafariPatcher",[],function(){"use strict";return{patchWidth:function(a,b,c,d,e){var f=e.os.ios&&e.browser.safari;if(f&&c.custom[a].hasIframe){b.css(a+"iframe",{width:1,minWidth:"100%"})}}}});define("tpa/layout/tpaLayout",["layout","tpa/layout/gluedWidgetPatcher","tpa/layout/gluedWidgetMeasurer","tpa/layout/tpaSectionPatcher","tpa/layout/tpaMeasurer","tpa/layout/tpaGluedWidgetPlacement","tpa/layout/mobileSafariPatcher"],function(a,b,c,d,e,f,g){"use strict";var h=new b(f);var i=new c(f);a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAWidget",e.measureTPA);a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPASection",e.measureTPA);a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAMultiSection",e.measureTPA);a.registerCustomMeasure("wysiwyg.viewer.components.tpapps.TPAGluedWidget",i.measureGluedWidget);a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAWidget");a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAGluedWidget");a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPASection");a.registerRequestToMeasureDom("wysiwyg.viewer.components.tpapps.TPAMultiSection");a.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPASection",[["iframe"]]);a.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPAMultiSection",[["iframe"]]);a.registerRequestToMeasureChildren("wysiwyg.viewer.components.tpapps.TPAWidget",[["iframe"]]);a.registerSAFEPatcher("wysiwyg.viewer.components.tpapps.TPAGluedWidget",h.patchGluedWidget);a.registerSAFEPatcher("wysiwyg.viewer.components.tpapps.TPAMultiSection",d.patchTPASection);a.registerSAFEPatcher("wysiwyg.viewer.components.tpapps.TPASection",d.patchTPASection);a.registerSAFEPatcher("wysiwyg.viewer.components.tpapps.TPAWidget",g.patchWidth);["wysiwyg.viewer.components.WixAdsMobile","wysiwyg.viewer.components.WixAdsDesktop"].forEach(function(b){a.registerRequestToMeasureChildren(b,[["desktopWADTop"],["desktopWADBottom"],["mobileWADTop"]]);a.registerCustomMeasure(b,i.measureWixAdComponent)});return{}});define("tpa/components/tpaPreloaderOverlay",["core"],function(a){"use strict";var b=a.compRegistrar;var c=a.compMixins;var d={mixins:[c.skinBasedComp],statics:{useSantaTypes:true},getSkinProperties:function(){return{preloader:{className:"circle-preloader"}}}};b.register("wysiwyg.viewer.components.tpapps.TPAPreloaderOverlay",d)});define("tpa/services/tpaPreviewEditorCommunicationService",["core"],function(a){"use strict";var b=[];var c=1;var d;var e=a.siteAspectsRegistry;var f=function(a){d=a;g()};e.registerSiteAspect("tpaPreviewEditorAspect",f);var g=function(){d.registerToMessage(j.bind(this))};var h=function(a,b,c,d){var e=i(a,b,c,d);var f;if(window.parent.postMessage){f=window.parent}else if(window.parent.document.postMessage){f=window.parent.document}if(f&&typeof f!=="undefined"){f.postMessage(JSON.stringify(e),"*")}};var i=function(a,d,e,f){var g={intent:"TPA_PREVIEW",callId:c++,type:a,compId:e,data:d};if(f){b[g.callId]=f}return g};var j=function(a){if(!a||!a.data){return}var c={};try{c=JSON.parse(a.data)}catch(a){return}switch(c.intent){case"TPA_PREVIEW":if(c.callId&&b[c.callId]){b[c.callId](c.res);delete b[c.callId]}break}};return{doPostMessage:h}});define("tpa/mixins/tpaPreviewEditorMixin",["tpa/services/tpaPreviewEditorCommunicationService"],function(a){"use strict";var b=function(b){a.doPostMessage("openHelp",b)};return{openHelp:b}});define("tpa/components/tpaUnavailableMessageOverlay",["react","santaProps","core","tpa/mixins/tpaPreviewEditorMixin"],function(a,b,c,d){"use strict";var e=c.compRegistrar;var f=c.compMixins;var g={displayName:"TPAUnavailableMessageOverlay",mixins:[f.skinBasedComp,d],propTypes:{compData:b.Types.Component.compData.isRequired},statics:{useSantaTypes:true},getInitialState:function(){return{showOverlay:true}},getSkinProperties:function(){return{text:{children:[this.props.compData.text]},dismissButton:{onClick:this.props.compData.hideOverlayFunc},openHelp:this.openHelp}}};e.register("wysiwyg.viewer.components.tpapps.TPAUnavailableMessageOverlay",g)});define("tpa",["tpa/components/tpaWidget","tpa/components/tpaSection","tpa/components/tpaMultiSection","tpa/components/tpaWorker","tpa/components/tpaGluedWidget","tpa/aspects/tpaAspectCollector","tpa/mixins/tpaUrlBuilderMixin","tpa/mixins/tpaCompApiMixin","tpa/layout/tpaLayout","tpa/components/tpaPreloaderOverlay","tpa/components/tpaUnavailableMessageOverlay","tpa/layout/gluedWidgetPatcher","tpa/layout/tpaMeasurer","tpa/layout/tpaSectionPatcher","tpa/mixins/tpaCompBaseMixin","tpa/common/tpaPostMessageCommon","tpa/handlers/tpaHandlers","tpa/common/TPAUrlBuilder","tpa/common/TPABaseUrlBuilder","tpa/utils/tpaStyleUtils","tpa/utils/tpaUtils","tpa/utils/gluedWidgetMeasuringUtils","tpa/services/tpaPreviewEditorCommunicationService","tpa/common/tpaBi","tpa/utils/sitePages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){"use strict";return{widget:a,section:b,multiSection:c,worker:d,gluedWidget:e,gluedWidgetMeasuringUtils:v,tpaMixins:{tpaUrlBuilder:g,tpaCompApi:h,tpaCompBase:o},GluedWidgetPatcher:l,tpaMeasurer:m,tpaSectionPatcher:n,tpaHandlers:q,common:{tpaPostMessageCommon:p,TPAUrlBuilder:r,styleUtils:t,TPABaseUrlBuilder:s,utils:u,bi:x},services:{tpaPreviewEditorCommunicationService:w},tpaStyleUtils:t,sitePages:y}});
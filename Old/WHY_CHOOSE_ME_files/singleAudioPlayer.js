define("singleAudioPlayer",["lodash","react","reactDOM","core","santaProps","audioCommon"],function(a,b,c,d,e,f){"use strict";var g=d.compMixins;var h=function(a){return a===0?0:Math.ceil(a/20)};var i=function(a){return a*20};var j=function(a){var b=a/1e3,c=Math.floor(b/60),d=Math.floor(b%60),e=c<10?"0"+c:c,f=d<10?"0"+d:d,g=e+":"+f;return g};var k=function(a,b,c){var d=(a.nativeEvent.offsetX?a.nativeEvent.offsetX:a.nativeEvent.layerX)/b,e=Math.ceil(d*c);return e};var l=function(a,b){if(b==="unmuted"){a.muteAudio()}else{a.unmuteAudio()}};return{displayName:"SingleAudioPlayer",mixins:[g.skinBasedComp,g.skinInfo,f.audioMixin],statics:{useSantaTypes:true},propTypes:{compData:e.Types.Component.compData.isRequired,compProp:e.Types.Component.compProp.isRequired,styleId:e.Types.Component.styleId.isRequired},getInitialState:function(){this.audioVolume=this.props.compProp.volume;this.autoPlay=this.props.compProp.autoplay;return{$playerState:"waiting",$device:this.getDeviceState(),$isduration:"duration",$isMuted:"unmuted",trackDuration:"00:00",trackPositionLabel:"00:00",progressPosition:0,volumeBars:h(this.props.compProp.volume),dragging:false,$heightChanged:false}},finishedPlayingAudio:function(){this.isAudioPlaying=false;if(this.props.compProp.loop){this.initiatePlay()}else{this.setState({$playerState:"repeat"})}},whileLoadingHandler:function(a){var b=j(a);this.setState({trackDuration:b})},whilePlayingHandler:function(a){var b=j(a),c=a/this.getAudioDuration()*100;this.setState({trackPositionLabel:b,progressPosition:c})},getProgressBarWidth:function(){return c.findDOMNode(this.refs.progressbar).offsetWidth},resetTrackPosition:function(){this.setState({trackPositionLabel:"00:00",progressPosition:0})},movingProgressbarHandle:function(a){var b=this.getProgressBarWidth(),c=this.getSkinExports("barSpaceLeft").barSpaceLeft,d=this.getSkinExports("barSpaceRight").barSpaceRight,e=this.props.style.width,f=a.pageX,g=this.getAudioDuration(),h=f<c||f>e-d,i=k(a,b,g);if(h){return}this.setState({trackPositionLabel:j(i),progressPosition:i/g*100});this.seekAudio(i)},stoppedMovingProgressbarHandle:function(a){var b=this.getProgressBarWidth();var c=this.getAudioDuration();var d=k(a,b,c);this.setState({trackPositionLabel:j(d),progressPosition:d/c*100});this.seekAudio(d)},callSeek:function(a){var b=this.getProgressBarWidth();var c=this.getAudioDuration();var d=k(a,b,c);this.seekAudio(d)},buildVolumeScale:function(){var c=5,d=this.props.styleId,e=this.state.volumeBars;return a.times(c,function(a){return b.DOM.li({className:a<e?d+"_on":d+"_off",onClick:this.setNonPersistentVolume,"data-index":a+1},b.DOM.div({className:d+"_colorBlock"}),b.DOM.div({className:d+"_colorBlank"}))}.bind(this))},callToggleMute:function(){l(this,this.state.$isMuted);if(this.state.$isMuted==="unmuted"){this.setState({$isMuted:"muted"})}else{this.setState({$isMuted:"unmuted"})}},getTargetIndex:function(a){return a.getAttribute("data-index")},setNonPersistentVolume:function(a){var b=this.getTargetIndex(a.currentTarget);this.setState({volumeBars:b});this.setVolume(i(b))},updateComponentHeight:function(a){return this.getSkinExports(a+"Height")[a+"Height"]},getSkinProperties:function(){this.autoPlay=this.props.compProp.autoplay;this.updateAudioObject();return{"":{style:{height:this.updateComponentHeight(this.getDeviceState())}},sep:{children:" - "},sep2:{children:" / "},artistLabel:{children:this.props.compData.artist},trackLabel:{children:this.props.compData.track},playBtn:{onClick:this.initiatePlay},pauseBtn:{onClick:this.initiatePause},repeatBtn:{onClick:this.initiatePlay},bar:{onClick:this.callSeek},slider:{onClick:this.callSeek,style:{width:this.state.progressPosition+"%"}},handle:{onDrag:this.movingProgressbarHandle,onDragEnd:this.stoppedMovingProgressbarHandle,style:{cursor:"pointer",left:this.state.progressPosition+"%"},draggable:true},volumeBtn:{onClick:this.callToggleMute},volumeScale:{children:this.buildVolumeScale()},trackDuration:{children:this.state.trackDuration},trackPosition:{children:this.state.trackPositionLabel}}}}});